<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø³ÛŒÙ„Ø² Ù…ÛŒÙ†Ø¬Ù…Ù†Ù¹</title>
    <!-- Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒØ² Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 8px;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1rem;
            opacity: 0.95;
            font-weight: 500;
        }
        
        .top-options {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .top-btn {
            background: rgba(255,255,255,0.25);
            border: 2px solid white;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            min-width: 120px;
        }
        
        .top-btn:hover {
            background: white;
            color: #ff6b6b;
            transform: translateY(-2px);
        }
        
        /* Ø´ÙˆØ±Ù¹ Ø³Ù…Ø±ÛŒ Ø³ÛŒÚ©Ø´Ù† */
        .summary-section {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 20px 15px;
            border-bottom: 3px solid #00a085;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .summary-card {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .summary-title {
            font-size: 0.9rem;
            margin-bottom: 8px;
            opacity: 0.9;
            font-weight: 600;
        }
        
        .summary-value {
            font-size: 1.4rem;
            font-weight: 800;
        }
        
        .cash-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .cash-btn {
            background: rgba(255,255,255,0.25);
            border: 2px solid white;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
        }
        
        .cash-btn:hover {
            background: white;
            color: #00b894;
            transform: translateY(-2px);
        }
        
        .handed-over-section {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .handed-over-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .handed-over-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            flex-wrap: wrap;
        }
        
        .handed-over-item:last-child {
            border-bottom: none;
        }
        
        .edit-entry-btn {
            background: rgba(255,255,255,0.3);
            border: 1px solid white;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
            margin-right: 8px;
        }
        
        .edit-entry-btn:hover {
            background: white;
            color: #00b894;
        }
        
        .date-section {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-bottom: 3px solid #e9ecef;
        }
        
        .date-section h2 {
            color: #2d3436;
            font-size: 1.3rem;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .current-date {
            font-size: 1.1rem;
            color: #e17055;
            font-weight: bold;
        }
        
        .shop-selector {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            padding: 15px;
            text-align: center;
        }
        
        .shop-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .shop-btn {
            background: white;
            border: none;
            padding: 12px 8px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #2d3436;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid transparent;
        }
        
        .shop-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
            border-color: #0984e3;
        }
        
        .shop-btn.active {
            background: #0984e3;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(9,132,227,0.3);
        }

        /* Ø´Ø§Ù¾ ÙˆØ§Ø¦Ø² Ú©ÛŒØ´ Ø³ÛŒÚ©Ø´Ù† */
        .shop-cash-section {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            padding: 15px;
            color: white;
            text-align: center;
        }
        
        .shop-cash-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .shop-cash-value {
            font-size: 1.8rem;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        /* Ù¾Ø±Ø§ÚˆÚ©Ù¹Ø³ Ù¹ÛŒØ¨Ù„ - Ù…ÙˆØ¨Ø§Ø¦Ù„ ÙØ±ÛŒÙ†ÚˆÙ„ÛŒ */
        .products-table-container {
            padding: 15px;
            background: #f8f9fa;
            overflow-x: auto;
            position: relative;
        }
        
        .products-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            min-width: 800px;
        }
        
        .products-table th {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 700;
            font-size: 0.9rem;
            border: 1px solid #e84393;
        }
        
        .products-table td {
            padding: 10px 8px;
            text-align: center;
            border: 1px solid #e9ecef;
            font-size: 0.85rem;
        }
        
        .products-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .products-table tr:hover {
            background: #f1f2f6;
        }
        
        .product-name-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 600;
            color: #2d3436;
            position: sticky;
            left: 0;
            background: white;
            z-index: 2;
            border-right: 2px solid #e9ecef;
            min-width: 120px;
        }
        
        .product-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #fd79a8, #e84393);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }
        
        .input-field {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            background: white;
            text-align: center;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #74b9ff;
            box-shadow: 0 0 0 3px rgba(116,185,255,0.1);
            background: #e3f2fd;
            transform: scale(1.02);
        }
        
        .old-weight {
            background: #f8f9fa;
            color: #636e72;
            font-weight: 600;
        }
        
        .edit-weight-btn {
            background: #74b9ff;
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
            margin-top: 4px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .edit-weight-btn:hover {
            background: #0984e3;
        }
        
        .result-value {
            font-weight: 600;
            color: #2d3436;
        }
        
        .view-entries-btn {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .view-entries-btn:hover {
            background: linear-gradient(135deg, #6c5ce7, #5b4fcf);
            transform: translateY(-1px);
        }
        
        .cash-section {
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            padding: 20px 15px;
            border-top: 4px solid #a4b0be;
        }
        
        .cash-input-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .cash-label {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2d3436;
        }
        
        .cash-input {
            padding: 10px 15px;
            border: 2px solid #74b9ff;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
            max-width: 280px;
            text-align: center;
            background: white;
            font-weight: 600;
        }
        
        .cash-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(116,185,255,0.2);
        }
        
        .auto-cash-btn {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 280px;
        }
        
        .auto-cash-btn:hover {
            transform: translateY(-2px);
        }
        
        .cash-comparison {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            border: 2px solid #e9ecef;
        }
        
        .comparison-title {
            font-size: 1rem;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 12px;
        }
        
        .comparison-result {
            font-size: 1.1rem;
            font-weight: 800;
            padding: 12px;
            border-radius: 6px;
            margin: 8px 0;
        }
        
        .comparison-positive {
            background: #d1f7e4;
            color: #00b894;
            border: 2px solid #00b894;
        }
        
        .comparison-negative {
            background: #ffe0e0;
            color: #d63031;
            border: 2px solid #d63031;
        }
        
        .comparison-equal {
            background: #f8f9fa;
            color: #636e72;
            border: 2px solid #b2bec3;
        }
        
        .save-btn {
            background: linear-gradient(135deg, #0984e3, #074b93);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto;
            width: 100%;
            max-width: 280px;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
        }
        
        .save-btn:disabled {
            background: #b2bec3;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Ù…ÙˆØ¯Ù„ Ø§Ø³Ù¹Ø§Ø¦Ù„Ø² */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            backdrop-filter: blur(5px);
            padding: 10px;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 95%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.25);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #f1f2f6;
        }
        
        .modal-title {
            font-size: 1.4rem;
            color: #2d3436;
            font-weight: 800;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #636e72;
            transition: color 0.3s ease;
        }
        
        .close-btn:hover {
            color: #d63031;
        }
        
        .expense-form {
            display: grid;
            gap: 15px;
        }
        
        .expense-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .expense-input-group {
            display: flex;
            flex-direction: column;
        }
        
        .expense-label {
            margin-bottom: 6px;
            font-weight: 700;
            color: #2d3436;
            font-size: 1rem;
        }
        
        .expense-input {
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .expense-input:focus {
            outline: none;
            border-color: #74b9ff;
        }
        
        .other-expenses-list {
            grid-column: 1 / -1;
        }
        
        .expense-item {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }
        
        .expense-item input {
            flex: 1;
        }
        
        .add-expense-btn {
            background: #74b9ff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .submit-expense {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 12px;
            transition: all 0.3s ease;
            grid-column: 1 / -1;
        }
        
        .submit-expense:hover {
            transform: translateY(-2px);
        }
        
        /* Ø±Ù¾ÙˆØ±Ù¹ Ø§Ø³Ù¹Ø§Ø¦Ù„Ø² */
        .report-controls {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 3px solid #e9ecef;
        }
        
        .report-filters {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .filter-label {
            font-weight: 600;
            color: #2d3436;
            font-size: 0.9rem;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .report-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .report-btn {
            background: linear-gradient(135deg, #0984e3, #074b93);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .report-btn:hover {
            transform: translateY(-2px);
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.8rem;
        }
        
        .report-table th,
        .report-table td {
            padding: 8px 10px;
            text-align: right;
            border: 1px solid #ddd;
        }
        
        .report-table th {
            background: #f8f9fa;
            font-weight: 700;
            color: #2d3436;
        }
        
        .report-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .profit-positive {
            color: #00b894;
            font-weight: bold;
        }
        
        .profit-negative {
            color: #d63031;
            font-weight: bold;
        }
        
        /* Ù„Ø§Ú¯ Ø§Ù† Ù…ÙˆØ¯Ù„ */
        .login-modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            backdrop-filter: blur(10px);
            padding: 20px;
        }
        
        .login-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 100%;
            max-width: 350px;
            margin: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        .login-title {
            font-size: 1.8rem;
            color: #2d3436;
            margin-bottom: 25px;
            font-weight: 800;
        }
        
        .login-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .login-input:focus {
            outline: none;
            border-color: #74b9ff;
        }
        
        .login-btn {
            background: linear-gradient(135deg, #0984e3, #074b93);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
        }
        
        .error-message {
            color: #d63031;
            margin-top: 8px;
            font-weight: 600;
            display: none;
        }
        
        /* ÙˆØ²Ù† Ø§ÛŒÚˆÙ¹ Ù…ÙˆØ¯Ù„ */
        .edit-weight-modal {
            display: none;
        }
        
        .edit-weight-content {
            max-width: 400px;
        }
        
        .password-input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            text-align: center;
        }
        
        .edit-weight-btns {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .confirm-btn {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .cancel-btn {
            background: linear-gradient(135deg, #636e72, #2d3436);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        /* ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ù…ÙˆØ¯Ù„ */
        .handed-over-modal {
            display: none;
        }
        
        .handed-over-form {
            display: grid;
            gap: 12px;
        }
        
        /* Ù¾Ø±Ø§ÚˆÚ©Ù¹ Ø§Ù†Ù¹Ø±ÛŒØ² Ù…ÙˆØ¯Ù„ */
        .product-entries-modal {
            display: none;
        }
        
        .product-entries-content {
            max-width: 95%;
        }
        
        .entries-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.8rem;
        }
        
        .entries-table th,
        .entries-table td {
            padding: 8px 10px;
            text-align: center;
            border: 1px solid #ddd;
        }
        
        .entries-table th {
            background: #f8f9fa;
            font-weight: 700;
            color: #2d3436;
        }
        
        .entries-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .edit-entry-btn-small {
            background: #74b9ff;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.3s ease;
            margin: 2px;
        }
        
        .edit-entry-btn-small:hover {
            background: #0984e3;
        }
        
        .delete-entry-btn {
            background: #ff7675;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.3s ease;
            margin: 2px;
        }
        
        .delete-entry-btn:hover {
            background: #d63031;
        }
        
        /* ØªÙ…Ø§Ù… ÚˆÛŒÙ„ÛŒÙ¹ Ù…ÙˆØ¯Ù„ */
        .delete-all-modal {
            display: none;
        }
        
        .delete-all-content {
            max-width: 400px;
        }
        
        .ice-cream-purchase-section {
            grid-column: 1 / -1;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin-top: 8px;
        }
        
        .purchase-status {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .purchase-status span {
            font-weight: 600;
            color: #2d3436;
            font-size: 0.9rem;
        }
        
        .purchase-pending {
            color: #e17055;
        }
        
        .purchase-paid {
            color: #00b894;
        }

        /* Ù…ÙˆØ¨Ø§Ø¦Ù„ Ø§Ø³Ù¾ÛŒØ³ÙÚ© Ø§Ø³Ù¹Ø§Ø¦Ù„Ø² */
        .mobile-only {
            display: block;
        }
        
        .desktop-only {
            display: none;
        }
        
        .mobile-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .mobile-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        /* Ù„ÙˆÚˆÙ†Ú¯ Ø§Ø³Ù¾Ù†Ø± */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 1.2rem;
        }

        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ù†ÙˆÙ¹ÛŒÙÚ©ÛŒØ´Ù† */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00b894;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* ÙØ§Ø³Ù¹ Ø§Ù†Ù¹Ø±ÛŒ ÛØ§Ø¦ÛŒ Ù„Ø§Ø¦Ù¹ */
        .current-input {
            background: #fff3e0 !important;
            border-color: #ff9800 !important;
        }

        /* Ù…ÙˆØ¨Ø§Ø¦Ù„ Ù¾Ø± Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©Û’ Ù†Ø§Ù… Ù†ÛŒÚ†Û’ Ø¯Ú©Ú¾Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ */
        @media (max-width: 768px) {
            .products-table th:first-child,
            .products-table td:first-child {
                position: sticky;
                left: 0;
                background: #fd79a8;
                color: white;
                z-index: 3;
                min-width: 120px;
            }
            
            .products-table td:first-child {
                background: white;
                border-right: 2px solid #e9ecef;
            }
            
            .product-name-cell {
                flex-direction: column;
                gap: 4px;
                text-align: center;
                padding: 8px 4px;
            }
            
            .product-icon {
                width: 25px;
                height: 25px;
                font-size: 0.8rem;
            }
            
            /* Ù†ÛŒØ§ ÙˆØ²Ù† Ø§ÙˆØ± Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù† Ú©Û’ Ú©Ø§Ù„Ù… Ù…ÛŒÚº Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©Ø§ Ù†Ø§Ù… Ø¯Ú©Ú¾Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ */
            .products-table td:nth-child(3)::before,
            .products-table td:nth-child(4)::before {
                content: attr(data-product-name);
                display: block;
                font-size: 0.7rem;
                color: #636e72;
                font-weight: 600;
                margin-bottom: 4px;
                background: #f8f9fa;
                padding: 2px 4px;
                border-radius: 3px;
                border: 1px solid #e9ecef;
            }
            
            .input-field {
                font-size: 16px; /* Ù…ÙˆØ¨Ø§Ø¦Ù„ Ù¾Ø± Ø²ÙˆÙ… Ø³Û’ Ø¨Ú†Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ */
                padding: 10px 8px;
            }
        }

        /* Ú†Ú¾ÙˆÙ¹Û’ Ù…ÙˆØ¨Ø§Ø¦Ù„ ÚˆÛŒÙˆØ§Ø¦Ø³Ø² Ú©Û’ Ù„ÛŒÛ’ Ø§Ø¶Ø§ÙÛŒ Ø§Ø³Ù¹Ø§Ø¦Ù„Ø² */
        @media (max-width: 480px) {
            .products-table {
                font-size: 0.75rem;
            }
            
            .products-table th,
            .products-table td {
                padding: 6px 4px;
            }
            
            .product-name-cell {
                min-width: 100px;
            }
            
            .input-field {
                padding: 8px 6px;
                font-size: 14px;
            }
            
            .edit-weight-btn,
            .view-entries-btn {
                font-size: 0.65rem;
                padding: 4px 6px;
            }
        }

        @media (min-width: 768px) {
            .mobile-only {
                display: none;
            }
            
            .desktop-only {
                display: block;
            }
            
            .shop-buttons {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .expense-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .report-filters {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .report-actions {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .cash-input-group {
                flex-direction: row;
            }
            
            .cash-input {
                width: 200px;
            }
            
            .auto-cash-btn {
                width: auto;
            }
            
            .top-options {
                position: absolute;
                left: 25px;
                top: 50%;
                transform: translateY(-50%);
                margin-top: 0;
                justify-content: flex-start;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.3rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .top-btn, .cash-btn {
                padding: 12px 15px;
                font-size: 0.9rem;
                min-width: 130px;
            }
            
            .summary-value {
                font-size: 1.2rem;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .modal-title {
                font-size: 1.2rem;
            }
            
            .input-field {
                padding: 12px 8px;
                font-size: 16px;
            }
        }

        @media (max-width: 768px) {
            .products-table th:first-child,
            .products-table td:first-child {
                position: sticky;
                left: 0;
                background: #fd79a8;
                color: white;
                z-index: 3;
            }
            
            .products-table td:first-child {
                background: white;
                border-right: 2px solid #e9ecef;
            }
            
            .products-table tr:focus-within {
                background: #e3f2fd !important;
            }
        }
    </style>
</head>
<body>
    <!-- Ù„ÙˆÚˆÙ†Ú¯ Ø§Ø³Ù¾Ù†Ø± -->
    <div class="loading-overlay" id="loadingSpinner">
        <div class="loading-spinner"></div>
        <p>Ù„ÙˆÚˆ ÛÙˆ Ø±ÛØ§ ÛÛ’...</p>
    </div>

    <!-- Ù„Ø§Ú¯ Ø§Ù† Ù…ÙˆØ¯Ù„ -->
    <div id="loginModal" class="modal login-modal" style="display: flex;">
        <div class="login-content">
            <h2 class="login-title">ğŸ¦ Ù„Ø§Ú¯ Ø§Ù† Ú©Ø±ÛŒÚº</h2>
            <input type="text" id="userId" class="login-input" placeholder="Ø¢Ø¦ÛŒ ÚˆÛŒ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº">
            <input type="password" id="password" class="login-input" placeholder="Ù¾Ø§Ø³ ÙˆØ±Úˆ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº">
            <button class="login-btn" onclick="login()">Ù„Ø§Ú¯ Ø§Ù† Ú©Ø±ÛŒÚº</button>
            <div class="error-message" id="loginError">ØºÙ„Ø· Ø¢Ø¦ÛŒ ÚˆÛŒ ÛŒØ§ Ù¾Ø§Ø³ ÙˆØ±Úˆ!</div>
        </div>
    </div>

    <!-- ÙˆØ²Ù† Ø§ÛŒÚˆÙ¹ Ù…ÙˆØ¯Ù„ -->
    <div id="editWeightModal" class="modal edit-weight-modal">
        <div class="modal-content edit-weight-content">
            <div class="modal-header">
                <h2 class="modal-title">Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº</h2>
                <button class="close-btn" onclick="closeEditWeightModal()">Ã—</button>
            </div>
            <div style="text-align: center;">
                <p style="margin-bottom: 15px; font-size: 1rem;">Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù¾Ø§Ø³ ÙˆØ±Úˆ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº:</p>
                <input type="password" id="editWeightPassword" class="password-input" placeholder="Ù¾Ø§Ø³ ÙˆØ±Úˆ">
                <div class="edit-weight-btns">
                    <button class="confirm-btn" onclick="confirmEditWeight()">ØªØµØ¯ÛŒÙ‚ Ú©Ø±ÛŒÚº</button>
                    <button class="cancel-btn" onclick="closeEditWeightModal()">Ù…Ù†Ø³ÙˆØ® Ú©Ø±ÛŒÚº</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ù…ÙˆØ¯Ù„ -->
    <div id="handedOverModal" class="modal handed-over-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ú©ÛŒØ´ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº</h2>
                <button class="close-btn" onclick="closeHandedOverModal()">Ã—</button>
            </div>
            <div class="handed-over-form">
                <div class="expense-input-group">
                    <label class="expense-label">ØªØ§Ø±ÛŒØ®</label>
                    <input type="date" class="expense-input" id="handedOverDate">
                </div>
                <div class="expense-input-group">
                    <label class="expense-label">Ø±Ù‚Ù…</label>
                    <input type="number" class="expense-input" id="handedOverAmount" placeholder="Ø±ÙˆÙ¾Û’ Ù…ÛŒÚº">
                </div>
                <div class="expense-input-group">
                    <label class="expense-label">ØªÙØµÛŒÙ„</label>
                    <input type="text" class="expense-input" id="handedOverDescription" placeholder="ØªÙØµÛŒÙ„ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº">
                </div>
                <button class="submit-expense" onclick="submitHandedOver()">ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº</button>
            </div>
        </div>
    </div>

    <!-- Ø§ÛŒÚˆÙ¹ Ø§Ù†Ù¹Ø±ÛŒ Ù…ÙˆØ¯Ù„ -->
    <div id="editEntryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Ø§Ù†Ù¹Ø±ÛŒ ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº</h2>
                <button class="close-btn" onclick="closeEditEntryModal()">Ã—</button>
            </div>
            <div class="handed-over-form">
                <div class="expense-input-group">
                    <label class="expense-label">ØªØ§Ø±ÛŒØ®</label>
                    <input type="date" class="expense-input" id="editEntryDate">
                </div>
                <div class="expense-input-group">
                    <label class="expense-label">Ù†ÛŒØ§ ÙˆØ²Ù† (Ú¯Ø±Ø§Ù…)</label>
                    <input type="number" class="expense-input" id="editEntryNewWeight" placeholder="Ù†ÛŒØ§ ÙˆØ²Ù†">
                </div>
                <div class="expense-input-group">
                    <label class="expense-label">Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù† (Ú¯Ø±Ø§Ù…)</label>
                    <input type="number" class="expense-input" id="editEntryCurrentWeight" placeholder="Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù†">
                </div>
                <button class="submit-expense" onclick="updateProductEntry()">Ø§Ù†Ù¹Ø±ÛŒ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº</button>
            </div>
        </div>
    </div>

    <!-- ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ø§ÛŒÚˆÙ¹ Ù…ÙˆØ¯Ù„ -->
    <div id="editHandedOverModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº</h2>
                <button class="close-btn" onclick="closeEditHandedOverModal()">Ã—</button>
            </div>
            <div class="handed-over-form">
                <div class="expense-input-group">
                    <label class="expense-label">ØªØ§Ø±ÛŒØ®</label>
                    <input type="date" class="expense-input" id="editHandedOverDate">
                </div>
                <div class="expense-input-group">
                    <label class="expense-label">Ø±Ù‚Ù…</label>
                    <input type="number" class="expense-input" id="editHandedOverAmount" placeholder="Ø±ÙˆÙ¾Û’ Ù…ÛŒÚº">
                </div>
                <div class="expense-input-group">
                    <label class="expense-label">ØªÙØµÛŒÙ„</label>
                    <input type="text" class="expense-input" id="editHandedOverDescription" placeholder="ØªÙØµÛŒÙ„ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº">
                </div>
                <button class="submit-expense" onclick="updateHandedOverEntry()">ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº</button>
            </div>
        </div>
    </div>

    <!-- Ù¾Ø±Ø§ÚˆÚ©Ù¹ Ø§Ù†Ù¹Ø±ÛŒØ² Ù…ÙˆØ¯Ù„ -->
    <div id="productEntriesModal" class="modal product-entries-modal">
        <div class="modal-content product-entries-content">
            <div class="modal-header">
                <h2 class="modal-title" id="productEntriesTitle">Ù¾Ø±Ø§ÚˆÚ©Ù¹ Ø§Ù†Ù¹Ø±ÛŒØ²</h2>
                <button class="close-btn" onclick="closeProductEntriesModal()">Ã—</button>
            </div>
            <div id="productEntriesContent">
                <!-- Ù¾Ø±Ø§ÚˆÚ©Ù¹ Ø§Ù†Ù¹Ø±ÛŒØ² Ú©Ø§ Ù…ÙˆØ§Ø¯ ÛŒÛØ§Úº Ù„ÙˆÚˆ ÛÙˆÚ¯Ø§ -->
            </div>
        </div>
    </div>

    <!-- Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø§Ù†Ù¹Ø±ÛŒØ² Ù…ÙˆØ¯Ù„ -->
    <div id="expenseEntriesModal" class="modal">
        <div class="modal-content product-entries-content">
            <div class="modal-header">
                <h2 class="modal-title">Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©ÛŒ Ø§Ù†Ù¹Ø±ÛŒØ²</h2>
                <button class="close-btn" onclick="closeExpenseEntriesModal()">Ã—</button>
            </div>
            <div id="expenseEntriesContent">
                <!-- Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø§Ù†Ù¹Ø±ÛŒØ² Ú©Ø§ Ù…ÙˆØ§Ø¯ ÛŒÛØ§Úº Ù„ÙˆÚˆ ÛÙˆÚ¯Ø§ -->
            </div>
        </div>
    </div>

    <!-- Ø§ÛŒÚˆÙ¹ Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ù…ÙˆØ¯Ù„ -->
    <div id="editExpenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Ø®Ø±Ú†Û ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº</h2>
                <button class="close-btn" onclick="closeEditExpenseModal()">Ã—</button>
            </div>
            <div class="expense-form">
                <div class="expense-grid">
                    <div class="expense-input-group">
                        <label class="expense-label">ØªØ§Ø±ÛŒØ®</label>
                        <input type="date" class="expense-input" id="editExpenseDate">
                    </div>
                    <div class="expense-input-group">
                        <label class="expense-label">Ø´Ø§Ù¾ Ú©Ø§ Ú©Ø±Ø§ÛŒÛ</label>
                        <input type="number" class="expense-input" id="editShopRent" placeholder="Ø±ÙˆÙ¾Û’ Ù…ÛŒÚº">
                    </div>
                    <div class="expense-input-group">
                        <label class="expense-label">Ø¨Ø¬Ù„ÛŒ Ú©Ø§ Ø¨Ù„</label>
                        <input type="number" class="expense-input" id="editElectricityBill" placeholder="Ø±ÙˆÙ¾Û’ Ù…ÛŒÚº">
                    </div>
                    <div class="expense-input-group">
                        <label class="expense-label">Ù…Ù„Ø§Ø²Ù…ÛŒÙ† Ú©ÛŒ ØªÙ†Ø®ÙˆØ§Û</label>
                        <input type="number" class="expense-input" id="editSalary" placeholder="Ø±ÙˆÙ¾Û’ Ù…ÛŒÚº">
                    </div>
                    <div class="expense-input-group">
                        <label class="expense-label">Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ…</label>
                        <input type="number" class="expense-input" id="editIceCreamPurchase" placeholder="Ú©Ù„ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©ÛŒ Ø±Ù‚Ù…">
                    </div>
                    <div class="expense-input-group">
                        <label class="expense-label">Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</label>
                        <input type="number" class="expense-input" id="editIceCreamPaid" placeholder="Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©ÛŒ Ú¯Ø¦ÛŒ Ø±Ù‚Ù…">
                    </div>
                </div>
                
                <div class="expense-input-group other-expenses-list">
                    <label class="expense-label">Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª</label>
                    <div id="editOtherExpensesContainer">
                        <!-- Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©Û’ ÙÛŒÙ„ÚˆØ² ÛŒÛØ§Úº Ø´Ø§Ù…Ù„ ÛÙˆÚº Ú¯Û’ -->
                    </div>
                    <button type="button" class="add-expense-btn" onclick="addEditExpenseField()">+ Ø®Ø±Ú†Û Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                </div>
                
                <button class="submit-expense" onclick="updateExpenseEntry()">Ø®Ø±Ú†Û Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº</button>
            </div>
        </div>
    </div>

    <!-- ØªÙ…Ø§Ù… ÚˆÛŒÙ„ÛŒÙ¹ Ù…ÙˆØ¯Ù„ -->
    <div id="deleteAllModal" class="modal delete-all-modal">
        <div class="modal-content delete-all-content">
            <div class="modal-header">
                <h2 class="modal-title">ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±ÛŒÚº</h2>
                <button class="close-btn" onclick="closeDeleteAllModal()">Ã—</button>
            </div>
            <div style="text-align: center;">
                <p style="margin-bottom: 15px; font-size: 1rem; color: #d63031;">
                    âš ï¸ ÛŒÛ Ø¹Ù…Ù„ ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ Ú©Ùˆ Ø­Ø°Ù Ú©Ø± Ø¯Û’ Ú¯Ø§ Ø§ÙˆØ± ÙˆØ§Ù¾Ø³ Ù†ÛÛŒÚº Ù„Ø§ÛŒØ§ Ø¬Ø§ Ø³Ú©Û’ Ú¯Ø§!
                </p>
                <p style="margin-bottom: 15px; font-size: 1rem;">Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù¾Ø§Ø³ ÙˆØ±Úˆ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº:</p>
                <input type="password" id="deleteAllPassword" class="password-input" placeholder="Ù¾Ø§Ø³ ÙˆØ±Úˆ">
                <div class="edit-weight-btns">
                    <button class="confirm-btn" onclick="confirmDeleteAll()" style="background: linear-gradient(135deg, #d63031, #c23616);">ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±ÛŒÚº</button>
                    <button class="cancel-btn" onclick="closeDeleteAllModal()">Ù…Ù†Ø³ÙˆØ® Ú©Ø±ÛŒÚº</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø¦ÛŒ Ø´Ø§Ù¾ Ø§ÛŒÚˆ Ù…ÙˆØ¯Ù„ -->
    <div id="addShopModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Ù†Ø¦ÛŒ Ø´Ø§Ù¾ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</h2>
                <button class="close-btn" onclick="closeAddShopModal()">Ã—</button>
            </div>
            <div class="expense-form">
                <div class="expense-input-group">
                    <label class="expense-label">Ø´Ø§Ù¾ Ú©Ø§ Ù†Ø§Ù…</label>
                    <input type="text" class="expense-input" id="newShopName" placeholder="Ø´Ø§Ù¾ Ú©Ø§ Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº">
                </div>
                <div class="expense-input-group">
                    <label class="expense-label">Ø´Ø§Ù¾ Ø¢Ø¦ÛŒ ÚˆÛŒ</label>
                    <input type="text" class="expense-input" id="newShopId" placeholder="Ø´Ø§Ù¾ Ø¢Ø¦ÛŒ ÚˆÛŒ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº">
                </div>
                <button class="submit-expense" onclick="addNewShop()">Ø´Ø§Ù¾ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
            </div>
        </div>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <!-- ÛÛŒÚˆØ± Ø³ÛŒÚ©Ø´Ù† -->
        <div class="header">
            <div class="top-options mobile-only">
                <button class="top-btn" onclick="openExpenseModal()">ğŸ“Š Ø§Ø®Ø±Ø§Ø¬Ø§Øª</button>
                <button class="top-btn" onclick="openReportModal()">ğŸ“ˆ Ø±Ù¾ÙˆØ±Ù¹</button>
                <button class="top-btn" onclick="openDeleteAllModal()" style="background: rgba(255,255,255,0.15);">ğŸ—‘ï¸ ÚˆÛŒÙ„ÛŒÙ¹</button>
                <button class="top-btn" onclick="openAddShopModal()" style="background: rgba(255,255,255,0.15);">ğŸª Ù†ÛŒØ§ Ø´Ø§Ù¾</button>
            </div>
            <h1>ğŸ¦ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø³ÛŒÙ„Ø² Ù…ÛŒÙ†Ø¬Ù…Ù†Ù¹</h1>
            <p>Ø±ÙˆØ²Ø§Ù†Û ÙˆØ²Ù† Ø§ÙˆØ± ÙØ±ÙˆØ®Øª Ú©Ø§ Ø±ÛŒÚ©Ø§Ø±Úˆ</p>
            <div class="top-options desktop-only">
                <button class="top-btn" onclick="openExpenseModal()">ğŸ“Š Ø§Ø®Ø±Ø§Ø¬Ø§Øª</button>
                <button class="top-btn" onclick="openReportModal()">ğŸ“ˆ Ø±Ù¾ÙˆØ±Ù¹</button>
                <button class="top-btn" onclick="openDeleteAllModal()" style="background: rgba(255,255,255,0.15);">ğŸ—‘ï¸ ØªÙ…Ø§Ù… ÚˆÛŒÙ„ÛŒÙ¹</button>
                <button class="top-btn" onclick="openAddShopModal()" style="background: rgba(255,255,255,0.15);">ğŸª Ù†ÛŒØ§ Ø´Ø§Ù¾</button>
            </div>
        </div>
        
        <!-- Ø´ÙˆØ±Ù¹ Ø³Ù…Ø±ÛŒ Ø³ÛŒÚ©Ø´Ù† -->
        <div class="summary-section">
            <h2 style="text-align: center; margin-bottom: 15px; font-size: 1.4rem;">ğŸ“Š Ø´ÙˆØ±Ù¹ Ø³Ù…Ø±ÛŒ</h2>
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-title">Ú©Ù„ ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ±</div>
                    <div class="summary-value" id="totalHandedOver">0 Ø±ÙˆÙ¾Û’</div>
                </div>
                <div class="summary-card">
                    <div class="summary-title">Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ</div>
                    <div class="summary-value" id="currentCashInHand">0 Ø±ÙˆÙ¾Û’</div>
                </div>
                <div class="summary-card">
                    <div class="summary-title">Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ù¾ÛŒÙ†ÚˆÙ†Ú¯</div>
                    <div class="summary-value" id="iceCreamPending">0 Ø±ÙˆÙ¾Û’</div>
                </div>
            </div>
            
            <div class="cash-buttons">
                <button class="cash-btn" onclick="openHandedOverModal()">ğŸ¤ Ù†ÛŒØ§ ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ±</button>
                <button class="cash-btn" onclick="toggleHandedOverDetails()">ğŸ“‹ ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± ÚˆÛŒÙ¹ÛŒÙ„Ø²</button>
                <button class="cash-btn" onclick="openExpenseEntriesModal()">ğŸ“‹ Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø§Ù†Ù¹Ø±ÛŒØ²</button>
            </div>
            
            <div class="handed-over-section" id="handedOverDetails" style="display: none;">
                <div class="handed-over-header">
                    <h3>ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</h3>
                </div>
                <div id="handedOverDetailsContent">
                    <!-- ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± ÚˆÛŒÙ¹ÛŒÙ„Ø² ÛŒÛØ§Úº Ù„ÙˆÚˆ ÛÙˆÚº Ú¯ÛŒ -->
                </div>
            </div>
        </div>
        
        <!-- ØªØ§Ø±ÛŒØ® Ø³ÛŒÚ©Ø´Ù† -->
        <div class="date-section">
            <h2>Ø¢Ø¬ Ú©ÛŒ ØªØ§Ø±ÛŒØ®</h2>
            <div class="current-date" id="currentDate"></div>
        </div>
        
        <!-- Ø´Ø§Ù¾ Ø³Ù„ÛŒÚ©Ù¹Ø± -->
        <div class="shop-selector">
            <div class="shop-buttons" id="shopButtonsContainer">
                <!-- Ø´Ø§Ù¾ Ø¨Ù¹Ù†Ø² JavaScript Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ù„ÙˆÚˆ ÛÙˆÚº Ú¯Û’ -->
            </div>
        </div>

        <!-- Ø´Ø§Ù¾ ÙˆØ§Ø¦Ø² Ú©ÛŒØ´ Ø³ÛŒÚ©Ø´Ù† -->
        <div class="shop-cash-section">
            <div class="shop-cash-title">ğŸ“Š Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©Ø§ Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ</div>
            <div class="shop-cash-value" id="currentShopCash">0 Ø±ÙˆÙ¾Û’</div>
        </div>
        
        <!-- Ù¾Ø±Ø§ÚˆÚ©Ù¹Ø³ Ù¹ÛŒØ¨Ù„ - ØªØ¨Ø¯ÛŒÙ„ Ø´Ø¯Û ÛÛŒÚˆØ±Ø² -->
        <div class="products-table-container">
            <table class="products-table" id="productsTable">
                <thead>
                    <tr>
                        <th>Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ…</th>
                        <th>Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù†</th>
                        <th>Ù†ÛŒØ§ ÙˆØ²Ù†</th>
                        <th>Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù†</th>
                        <th>Ø³ÛŒÙ„ Ú©ÛŒ Ø±Ù‚Ù…</th>
                        <th>Ø§Ù†Ù¹Ø±ÛŒØ²</th>
                    </tr>
                </thead>
                <tbody id="productsTableBody">
                    <!-- Ù¾Ø±Ø§ÚˆÚ©Ù¹Ø³ Ú©Ø§ ÚˆÛŒÙ¹Ø§ JavaScript Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ù„ÙˆÚˆ ÛÙˆÚ¯Ø§ -->
                </tbody>
            </table>
        </div>
        
        <!-- Ú©ÛŒØ´ Ø³ÛŒÚ©Ø´Ù† -->
        <div class="cash-section">
            <div class="cash-input-group">
                <span class="cash-label">Ù¹ÙˆÙ¹Ù„ Ú©ÛŒØ´:</span>
                <input type="number" class="cash-input" id="totalCash" placeholder="Ú©Ù„ Ú©ÛŒØ´ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº" oninput="updateCashComparison()">
                <button class="auto-cash-btn" onclick="autoCalculateCash()">ğŸ”¢ Ø®ÙˆØ¯Ú©Ø§Ø± Ú©ÛŒØ´</button>
            </div>
            
            <div class="cash-comparison" id="cashComparison">
                <div class="comparison-title">Ú©ÛŒØ´ Ù…ÙˆØ§Ø²Ù†Û</div>
                <div class="comparison-result" id="comparisonResult">Ø¨Ø±Ø§Û Ú©Ø±Ù… Ú©ÛŒØ´ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº</div>
            </div>
            
            <button class="save-btn" id="saveBtn" onclick="saveAllData()" disabled>ğŸ’¾ Ø³Ø§Ø±Ø§ ÚˆÛŒÙ¹Ø§ Ø³ÛŒÙˆ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <!-- Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ù…ÙˆØ¯Ù„ -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“Š Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº - <span id="expenseShopName"></span></h2>
                <button class="close-btn" onclick="closeExpenseModal()">Ã—</button>
            </div>
            <div class="expense-form">
                <div class="expense-grid">
                    <div class="expense-input-group">
                        <label class="expense-label">Ø´Ø§Ù¾ Ú©Ø§ Ú©Ø±Ø§ÛŒÛ</label>
                        <input type="number" class="expense-input" id="shopRent" placeholder="Ø±ÙˆÙ¾Û’ Ù…ÛŒÚº">
                    </div>
                    <div class="expense-input-group">
                        <label class="expense-label">Ø¨Ø¬Ù„ÛŒ Ú©Ø§ Ø¨Ù„</label>
                        <input type="number" class="expense-input" id="electricityBill" placeholder="Ø±ÙˆÙ¾Û’ Ù…ÛŒÚº">
                    </div>
                    <div class="expense-input-group">
                        <label class="expense-label">Ù…Ù„Ø§Ø²Ù…ÛŒÙ† Ú©ÛŒ ØªÙ†Ø®ÙˆØ§Û</label>
                        <input type="number" class="expense-input" id="salary" placeholder="Ø±ÙˆÙ¾Û’ Ù…ÛŒÚº">
                    </div>
                    <div class="expense-input-group">
                        <label class="expense-label">Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ…</label>
                        <input type="number" class="expense-input" id="iceCreamPurchase" placeholder="Ú©Ù„ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©ÛŒ Ø±Ù‚Ù…">
                    </div>
                    <div class="expense-input-group">
                        <label class="expense-label">Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</label>
                        <input type="number" class="expense-input" id="iceCreamPaid" placeholder="Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©ÛŒ Ú¯Ø¦ÛŒ Ø±Ù‚Ù…">
                    </div>
                </div>
                
                <div class="ice-cream-purchase-section">
                    <div class="purchase-status">
                        <span>Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ù¾ÛŒÙ†ÚˆÙ†Ú¯:</span>
                        <span id="iceCreamPendingDisplay" class="purchase-pending">0 Ø±ÙˆÙ¾Û’</span>
                    </div>
                </div>
                
                <div class="expense-input-group other-expenses-list">
                    <label class="expense-label">Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª</label>
                    <div id="otherExpensesContainer">
                        <div class="expense-item">
                            <input type="text" class="expense-input" placeholder="Ø®Ø±Ú†Û’ Ú©Ø§ Ù†Ø§Ù…" id="expenseName0">
                            <input type="number" class="expense-input" placeholder="Ø±Ù‚Ù…" id="expenseAmount0">
                        </div>
                    </div>
                    <button type="button" class="add-expense-btn" onclick="addExpenseField()">+ Ø®Ø±Ú†Û Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                </div>
                
                <button class="submit-expense" onclick="submitExpenses()">Ø®Ø±Ú†Û Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº</button>
            </div>
        </div>
    </div>

    <!-- Ø±Ù¾ÙˆØ±Ù¹ Ù…ÙˆØ¯Ù„ -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“ˆ ÚˆÛŒÙ¹Ø§ Ø±Ù¾ÙˆØ±Ù¹</h2>
                <button class="close-btn" onclick="closeReportModal()">Ã—</button>
            </div>
            <div class="report-controls">
                <div class="report-filters">
                    <div class="filter-group">
                        <label class="filter-label">Ø´Ø§Ù¾ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</label>
                        <select class="filter-select" id="reportShop">
                            <option value="all">ØªÙ…Ø§Ù… Ø´Ø§Ù¾Ø³</option>
                            <!-- Ø´Ø§Ù¾Ø³ JavaScript Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ù„ÙˆÚˆ ÛÙˆÚº Ú¯ÛŒ -->
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Ø³Û’ ØªØ§Ø±ÛŒØ®</label>
                        <input type="date" class="filter-select" id="reportFromDate">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ØªÚ© ØªØ§Ø±ÛŒØ®</label>
                        <input type="date" class="filter-select" id="reportToDate">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Ø±Ù¾ÙˆØ±Ù¹ Ù¹Ø§Ø¦Ù¾</label>
                        <select class="filter-select" id="reportType">
                            <option value="daily">Ø±ÙˆØ²Ø§Ù†Û</option>
                            <option value="weekly">ÛÙØªÛ ÙˆØ§Ø±</option>
                            <option value="monthly">Ù…Ø§ÛØ§Ù†Û</option>
                            <option value="yearly">Ø³Ø§Ù„Ø§Ù†Û</option>
                        </select>
                    </div>
                </div>
                <div class="report-actions">
                    <button class="report-btn" onclick="generateReport()">ğŸ“Š Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
                    <button class="report-btn" onclick="exportToPDF()">ğŸ“„ PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ</button>
                    <button class="report-btn" onclick="exportToExcel()">ğŸ“Š Excel ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ</button>
                    <button class="report-btn" onclick="printReport()">ğŸ–¨ï¸ Ù¾Ø±Ù†Ù¹ Ú©Ø±ÛŒÚº</button>
                </div>
            </div>
            <div id="reportContent">
                <!-- Ø±Ù¾ÙˆØ±Ù¹ Ú©Ø§ Ù…ÙˆØ§Ø¯ ÛŒÛØ§Úº Ù„ÙˆÚˆ ÛÙˆÚ¯Ø§ -->
            </div>
        </div>
    </div>

    <script>
        // Ø´Ø§Ù¾Ø³ Ú©Ø§ ÚˆÛŒÙ¹Ø§
        const shopsData = {
            delhi: {
                name: "Ø¯ÛÙ„ÛŒ Ú¯ÛŒÙ¹",
                products: [
                    { name: "Ù¾Ø³ØªÛ Ø¨Ø§Ø¯Ø§Ù…", icon: "ğŸŒ°", oldWeight: 0 },
                    { name: "Ø³Ù¹Ø±Ø§Ø¨Ø±ÛŒ", icon: "ğŸ“", oldWeight: 0 },
                    { name: "Ú†Ø§Ú©Ù„ÛŒÙ¹", icon: "ğŸ«", oldWeight: 0 },
                    { name: "Ù¹ÙˆÙ¹ÛŒ ÙØ±ÙˆÙ¹ÛŒ", icon: "ğŸ", oldWeight: 0 },
                    { name: "Ù…ÛŒÙ†Ú¯Ùˆ", icon: "ğŸ¥­", oldWeight: 0 },
                    { name: "Ø¨Ù„ÛŒÙˆ Ø¨ÛŒØ±ÛŒ", icon: "ğŸ«", oldWeight: 0 },
                    { name: "Ù¾Ø§Ø¦Ù† Ø§ÛŒÙ¾Ù„", icon: "ğŸ", oldWeight: 0 },
                    { name: "ÙˆÙ†ÛŒÙ„Ø§", icon: "ğŸ¦", oldWeight: 0 },
                    { name: "Ø§ÙˆØ±ÛŒÙˆ", icon: "ğŸª", oldWeight: 0 },
                    { name: "Ù‚Ù„ÙÛ", icon: "ğŸ§", oldWeight: 0 }
                ]
            },
            shahalam: {
                name: "Ø´Ø§Û Ø¹Ø§Ù„Ù…",
                products: [
                    { name: "Ù¾Ø³ØªÛ Ø¨Ø§Ø¯Ø§Ù…", icon: "ğŸŒ°", oldWeight: 0 },
                    { name: "Ø³Ù¹Ø±Ø§Ø¨Ø±ÛŒ", icon: "ğŸ“", oldWeight: 0 },
                    { name: "Ú†Ø§Ú©Ù„ÛŒÙ¹", icon: "ğŸ«", oldWeight: 0 },
                    { name: "Ù¹ÙˆÙ¹ÛŒ ÙØ±ÙˆÙ¹ÛŒ", icon: "ğŸ", oldWeight: 0 },
                    { name: "Ù…ÛŒÙ†Ú¯Ùˆ", icon: "ğŸ¥­", oldWeight: 0 },
                    { name: "Ø¨Ù„ÛŒÙˆ Ø¨ÛŒØ±ÛŒ", icon: "ğŸ«", oldWeight: 0 },
                    { name: "Ù¾Ø§Ø¦Ù† Ø§ÛŒÙ¾Ù„", icon: "ğŸ", oldWeight: 0 },
                    { name: "ÙˆÙ†ÛŒÙ„Ø§", icon: "ğŸ¦", oldWeight: 0 },
                    { name: "Ø§ÙˆØ±ÛŒÙˆ", icon: "ğŸª", oldWeight: 0 },
                    { name: "Ù‚Ù„ÙÛ", icon: "ğŸ§", oldWeight: 0 }
                ]
            },
            lohari: {
                name: "Ù„ÙˆÛØ§Ø±ÛŒ Ú¯ÛŒÙ¹",
                products: [
                    { name: "Ù¾Ø³ØªÛ Ø¨Ø§Ø¯Ø§Ù…", icon: "ğŸŒ°", oldWeight: 0 },
                    { name: "Ø³Ù¹Ø±Ø§Ø¨Ø±ÛŒ", icon: "ğŸ“", oldWeight: 0 },
                    { name: "Ú†Ø§Ú©Ù„ÛŒÙ¹", icon: "ğŸ«", oldWeight: 0 },
                    { name: "Ù¹ÙˆÙ¹ÛŒ ÙØ±ÙˆÙ¹ÛŒ", icon: "ğŸ", oldWeight: 0 },
                    { name: "Ù…ÛŒÙ†Ú¯Ùˆ", icon: "ğŸ¥­", oldWeight: 0 },
                    { name: "Ø¨Ù„ÛŒÙˆ Ø¨ÛŒØ±ÛŒ", icon: "ğŸ«", oldWeight: 0 },
                    { name: "Ù¾Ø§Ø¦Ù† Ø§ÛŒÙ¾Ù„", icon: "ğŸ", oldWeight: 0 },
                    { name: "ÙˆÙ†ÛŒÙ„Ø§", icon: "ğŸ¦", oldWeight: 0 },
                    { name: "Ø§ÙˆØ±ÛŒÙˆ", icon: "ğŸª", oldWeight: 0 },
                    { name: "Ù‚Ù„ÙÛ", icon: "ğŸ§", oldWeight: 0 }
                ]
            },
            bilal: {
                name: "Ø¨Ù„Ø§Ù„ Ú¯Ù†Ø¬",
                products: [
                    { name: "Ù¾Ø³ØªÛ Ø¨Ø§Ø¯Ø§Ù…", icon: "ğŸŒ°", oldWeight: 0 },
                    { name: "Ø³Ù¹Ø±Ø§Ø¨Ø±ÛŒ", icon: "ğŸ“", oldWeight: 0 },
                    { name: "Ú†Ø§Ú©Ù„ÛŒÙ¹", icon: "ğŸ«", oldWeight: 0 },
                    { name: "Ù¹ÙˆÙ¹ÛŒ ÙØ±ÙˆÙ¹ÛŒ", icon: "ğŸ", oldWeight: 0 },
                    { name: "Ù…ÛŒÙ†Ú¯Ùˆ", icon: "ğŸ¥­", oldWeight: 0 },
                    { name: "Ø¨Ù„ÛŒÙˆ Ø¨ÛŒØ±ÛŒ", icon: "ğŸ«", oldWeight: 0 },
                    { name: "Ù¾Ø§Ø¦Ù† Ø§ÛŒÙ¾Ù„", icon: "ğŸ", oldWeight: 0 },
                    { name: "ÙˆÙ†ÛŒÙ„Ø§", icon: "ğŸ¦", oldWeight: 0 },
                    { name: "Ø§ÙˆØ±ÛŒÙˆ", icon: "ğŸª", oldWeight: 0 },
                    { name: "Ù‚Ù„ÙÛ", icon: "ğŸ§", oldWeight: 0 }
                ]
            }
        };

        // Ú¯Ù„ÙˆØ¨Ù„ ÙˆÛŒØ±ÛŒ Ø§ÛŒØ¨Ù„Ø²
        let currentShop = 'delhi';
        let expensesData = {};
        let salesData = {};
        let expenseCounter = 1;
        let editExpenseCounter = 0;
        let allSavedData = [];
        let currentEditingProductIndex = -1;
        let isLoggedIn = false;
        let handedOverData = [];
        let currentEditingEntry = null;
        let currentViewingProductIndex = -1;
        let iceCreamPurchaseData = {};
        let currentEditingExpenseEntry = null;
        let currentEditingHandedOverEntry = null;
        const LOGIN_PASSWORD = "Saab";
        const SYSTEM_PASSWORD = "4088";

        // ÙØ§Ø³Ù¹ Ø§Ù†Ù¹Ø±ÛŒ Ø³Ø³Ù¹Ù…
        let currentFocusIndex = 0;
        let currentColumn = 0;

        // Ù„ÙˆÚˆÙ†Ú¯ Ø§Ø³Ù¾Ù†Ø± ÙÙ†Ú©Ø´Ù†Ø²
        function showLoading(show = true) {
            document.getElementById('loadingSpinner').style.display = show ? 'flex' : 'none';
        }

        // Ù†ÙˆÙ¹ÛŒÙÚ©ÛŒØ´Ù† ÙÙ†Ú©Ø´Ù†
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Ø§ÛŒØ±Ø± ÛÛŒÙ†ÚˆÙ„Ù†Ú¯ ÙÙ†Ú©Ø´Ù†Ø²
        function showError(message) {
            alert(`âŒ ${message}`);
        }

        function showSuccess(message) {
            alert(`âœ… ${message}`);
        }

        // ÚˆÛŒÙ¹Ø§ ÙˆØ§Ù„ÛŒÚˆÛŒØ´Ù†
        function validateSalesData(data) {
            const errors = [];
            
            if (!data.shop) errors.push('Ø´Ø§Ù¾ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº');
            if (data.totalCash < 0) errors.push('Ú©ÛŒØ´ Ù…Ù†ÙÛŒ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªØ§');
            
            data.salesData.forEach((product, index) => {
                if (product.soldAmount < 0) {
                    errors.push(`${shopsData[data.shop].products[index].name} Ú©ÛŒ Ø³ÛŒÙ„ Ù…Ù†ÙÛŒ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªÛŒ`);
                }
                if (product.currentWeight < 0) {
                    errors.push(`${shopsData[data.shop].products[index].name} Ú©Ø§ Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù† Ù…Ù†ÙÛŒ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªØ§`);
                }
            });
            
            return errors;
        }

        // Ù¾Ø§Ø³ ÙˆØ±Úˆ Ú†ÛŒÚ© Ø³Ø³Ù¹Ù…
        function addPasswordCheck(callback, actionName) {
            const password = prompt(`${actionName} Ú©Û’ Ù„ÛŒÛ’ Ø³Ø³Ù¹Ù… Ù¾Ø§Ø³ ÙˆØ±Úˆ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº:`);
            if (password === SYSTEM_PASSWORD) {
                callback();
            } else {
                showError('ØºÙ„Ø· Ù¾Ø§Ø³ ÙˆØ±Úˆ!');
            }
        }

        // ÙØ§Ø³Ù¹ Ø§Ù†Ù¹Ø±ÛŒ Ø³Ø³Ù¹Ù…
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                moveToNextCell();
            }
            
            // Ctrl + Enter: Ø³ÛŒÙˆ ÚˆÛŒÙ¹Ø§
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                if (!document.getElementById('saveBtn').disabled) {
                    saveAllData();
                }
            }
            
            // Ø´Ø§Ø±Ù¹ Ú©Ù¹ Ú©ÛŒ Ø¨ÙˆØ±Úˆ
            if (e.ctrlKey) {
                if (e.key === '1') {
                    const btn = document.querySelector('[data-shop="delhi"]');
                    if (btn) btn.click();
                } else if (e.key === '2') {
                    const btn = document.querySelector('[data-shop="shahalam"]');
                    if (btn) btn.click();
                } else if (e.key === '3') {
                    const btn = document.querySelector('[data-shop="lohari"]');
                    if (btn) btn.click();
                } else if (e.key === '4') {
                    const btn = document.querySelector('[data-shop="bilal"]');
                    if (btn) btn.click();
                }
            }
        });

        function moveToNextCell() {
            const rows = document.querySelectorAll('#productsTableBody tr');
            if (rows.length === 0) return;
            
            const currentRow = rows[Math.floor(currentFocusIndex / 2)];
            if (!currentRow) return;
            
            const columns = currentRow.querySelectorAll('input[type="number"]');
            if (columns.length === 0) return;
            
            // Ù…ÙˆØ¬ÙˆØ¯Û Ú©Ø§Ù„Ù…
            currentColumn++;
            
            // Ø§Ú¯Ø± Ø¢Ø®Ø±ÛŒ Ú©Ø§Ù„Ù… ÛÛ’ ØªÙˆ Ø§Ú¯Ù„ÛŒ Ù‚Ø·Ø§Ø± Ù¾Ø± Ø¬Ø§Ø¦ÛŒÚº
            if (currentColumn >= columns.length) {
                currentColumn = 0;
                currentFocusIndex += 2;
            }
            
            // Ø§Ú¯Ø± Ø¢Ø®Ø±ÛŒ Ù‚Ø·Ø§Ø± ÛÛ’ ØªÙˆ Ù¾ÛÙ„ÛŒ Ù‚Ø·Ø§Ø± Ù¾Ø± ÙˆØ§Ù¾Ø³ Ø¬Ø§Ø¦ÛŒÚº
            if (currentFocusIndex >= rows.length * 2) {
                currentFocusIndex = 0;
                currentColumn = 0;
            }
            
            // Ù†Ø¦Û’ Ú©Ø§Ù„Ù… Ù¾Ø± ÙÙˆÚ©Ø³ Ú©Ø±ÛŒÚº
            const newRowIndex = Math.floor(currentFocusIndex / 2);
            const newRow = rows[newRowIndex];
            if (newRow) {
                const newColumns = newRow.querySelectorAll('input[type="number"]');
                if (newColumns[currentColumn]) {
                    // Ù¾Ø±Ø§Ù†Û’ ÙÙˆÚ©Ø³ Ú©Ùˆ ÛÙ¹Ø§Ø¦ÛŒÚº
                    document.querySelectorAll('.current-input').forEach(el => {
                        el.classList.remove('current-input');
                    });
                    
                    // Ù†Ø¦Û’ ÙÙˆÚ©Ø³ Ú©Ùˆ ÛØ§Ø¦ÛŒ Ù„Ø§Ø¦Ù¹ Ú©Ø±ÛŒÚº
                    newColumns[currentColumn].classList.add('current-input');
                    newColumns[currentColumn].focus();
                    newColumns[currentColumn].select();
                }
            }
        }

        // Ø§Ù† Ù¾Ù¹ ÙÛŒÙ„ÚˆØ² Ù¾Ø± ÙÙˆÚ©Ø³ ÛÙˆÙ†Û’ Ù¾Ø± Ø§Ù†ÚˆÛŒÚ©Ø³ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
        document.addEventListener('focusin', function(e) {
            if (e.target.matches('.new-weight, .current-weight')) {
                const rows = document.querySelectorAll('#productsTableBody tr');
                const rowIndex = Array.from(rows).indexOf(e.target.closest('tr'));
                const inputs = e.target.closest('tr').querySelectorAll('input[type="number"]');
                const inputIndex = Array.from(inputs).indexOf(e.target);
                
                currentFocusIndex = rowIndex * 2;
                currentColumn = inputIndex;
                
                // ÛØ§Ø¦ÛŒ Ù„Ø§Ø¦Ù¹ Ù…ÙˆØ¬ÙˆØ¯Û Ø§Ù† Ù¾Ù¹
                document.querySelectorAll('.current-input').forEach(el => {
                    el.classList.remove('current-input');
                });
                e.target.classList.add('current-input');
            }
        });

        // Ù„Ø§Ú¯ Ø§Ù† ÙÙ†Ú©Ø´Ù†
        function login() {
            const userId = document.getElementById('userId').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('loginError');

            if (userId === '03237131918' && password === LOGIN_PASSWORD) {
                isLoggedIn = true;
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'block';
                
                showLoading(true);
                setTimeout(() => {
                    // Ù„ÙˆÚ©Ù„ Ø§Ø³Ù¹ÙˆØ±ÛŒØ¬ Ø³Û’ ÚˆÛŒÙ¹Ø§ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº
                    loadAllSavedData();
                    updateCurrentDate();
                    updateShopSelector();
                    loadShopData('delhi');
                    updateSummary();
                    updateCurrentShopCash();
                    showLoading(false);
                }, 1000);
            } else {
                errorElement.style.display = 'block';
            }
        }

        // ØªÙ…Ø§Ù… Ø³ÛŒÙˆ ÚˆÛŒÙ¹Ø§ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº - Ø¯Ø±Ø³Øª Ø´Ø¯Û ÙˆØ±Ú˜Ù†
        function loadAllSavedData() {
            allSavedData = [];
            handedOverData = [];
            iceCreamPurchaseData = {};
            
            // ØªÙ…Ø§Ù… Ø´Ø§Ù¾Ø³ Ú©Û’ Ù¾Ø±Ø§Ù†Û’ ÙˆØ²Ù† Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº
            Object.keys(shopsData).forEach(shopId => {
                shopsData[shopId].products.forEach(product => {
                    product.oldWeight = 0;
                });
            });
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                try {
                    if (key.startsWith('iceCreamData_')) {
                        const data = JSON.parse(localStorage.getItem(key));
                        allSavedData.push({...data, key: key});
                        
                        // Ø´Ø§Ù¾ Ú©Ø§ Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
                        if (data.shop && data.salesData && shopsData[data.shop]) {
                            data.salesData.forEach((product, index) => {
                                if (shopsData[data.shop].products[index]) {
                                    // Ø¢Ø®Ø±ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§ Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù† Ù¾Ø±Ø§Ù†Û’ ÙˆØ²Ù† Ú©Û’ Ø·ÙˆØ± Ù¾Ø± Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº
                                    shopsData[data.shop].products[index].oldWeight = product.currentWeight || 0;
                                }
                            });
                        }
                    } else if (key.startsWith('handedOver_')) {
                        const data = JSON.parse(localStorage.getItem(key));
                        // Ù¾Ø±Ø§Ù†Û’ ÚˆÛŒÙ¹Ø§ Ú©Û’ Ù„ÛŒÛ’ Ø´Ø§Ù¾ Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº
                        if (!data.shop) {
                            // key Ø³Û’ Ø´Ø§Ù¾ Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†Ú©Ø§Ù„ÛŒÚº
                            const keyParts = key.split('_');
                            if (keyParts.length >= 2) {
                                data.shop = keyParts[1];
                            }
                        }
                        handedOverData.push({...data, key: key});
                    } else if (key.startsWith('expenseData_')) {
                        const data = JSON.parse(localStorage.getItem(key));
                        allSavedData.push({...data, key: key});
                        
                        // Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ ÚˆÛŒÙ¹Ø§ Ú©Ùˆ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº
                        if (data.shop && data.expenses) {
                            if (!iceCreamPurchaseData[data.shop]) {
                                iceCreamPurchaseData[data.shop] = {
                                    totalPurchase: 0,
                                    totalPaid: 0
                                };
                            }
                            iceCreamPurchaseData[data.shop].totalPurchase += data.expenses.iceCreamPurchase || 0;
                            iceCreamPurchaseData[data.shop].totalPaid += data.expenses.iceCreamPaid || 0;
                        }
                    }
                } catch (error) {
                    console.error('Error loading data from key:', key, error);
                }
            }
            
            // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± ÚˆÛŒÙ¹Ø§ Ú©Ùˆ ØªØ§Ø±ÛŒØ® Ú©Û’ Ø­Ø³Ø§Ø¨ Ø³Û’ ØªØ±ØªÛŒØ¨ Ø¯ÛŒÚº
            handedOverData.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        // Ù…ÙˆØ¬ÙˆØ¯Û ØªØ§Ø±ÛŒØ® Ø¯Ú©Ú¾Ø§Ø¦ÛŒÚº
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                timeZone: 'Asia/Karachi'
            };
            const urduDate = now.toLocaleDateString('ur-PK', options);
            document.getElementById('currentDate').textContent = urduDate;
        }
        
        // Ø´Ø§Ù¾ Ø³Ù„ÛŒÚ©Ù¹Ø± Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
        function updateShopSelector() {
            const shopButtons = document.getElementById('shopButtonsContainer');
            const reportShop = document.getElementById('reportShop');
            
            // Ù…ÙˆØ¬ÙˆØ¯Û Ø¢Ù¾Ø´Ù†Ø² Ø®Ø§Ù„ÛŒ Ú©Ø±ÛŒÚº
            shopButtons.innerHTML = '';
            reportShop.innerHTML = '<option value="all">ØªÙ…Ø§Ù… Ø´Ø§Ù¾Ø³</option>';
            
            // ØªÙ…Ø§Ù… Ø´Ø§Ù¾Ø³ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº
            Object.keys(shopsData).forEach(shopId => {
                // Ø´Ø§Ù¾ Ø¨Ù¹Ù†Ø²
                const button = document.createElement('button');
                button.className = `shop-btn ${shopId === currentShop ? 'active' : ''}`;
                button.setAttribute('data-shop', shopId);
                button.textContent = shopsData[shopId].name;
                button.addEventListener('click', function() {
                    document.querySelectorAll('.shop-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    loadShopData(shopId);
                });
                shopButtons.appendChild(button);
                
                // Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ±Ø§Ù¾ ÚˆØ§Ø¤Ù†
                const option = document.createElement('option');
                option.value = shopId;
                option.textContent = shopsData[shopId].name;
                reportShop.appendChild(option);
            });
        }
        
        // Ø´Ø§Ù¾ Ú©Ø§ ÚˆÛŒÙ¹Ø§ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº - Ø§Ù¾ÚˆÛŒÙ¹ Ø´Ø¯Û ÙˆØ±Ú˜Ù†
        function loadShopData(shopId) {
            currentShop = shopId;
            const shop = shopsData[shopId];
            const tableBody = document.getElementById('productsTableBody');
            
            tableBody.innerHTML = '';
            
            shop.products.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="product-name-cell">
                            <div class="product-icon">${product.icon}</div>
                            <span>${product.name}</span>
                        </div>
                    </td>
                    <td>
                        <input type="number" class="input-field old-weight" value="${product.oldWeight}" readonly>
                        <button class="edit-weight-btn" onclick="openEditWeightModal(${index})">âœï¸ Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº</button>
                    </td>
                    <td data-product-name="${product.name}">
                        <input type="number" class="input-field new-weight" placeholder="Ù†ÛŒØ§ ÙˆØ²Ù† Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº" 
                               oninput="calculateProduct(${index})" id="newWeight${index}">
                    </td>
                    <td data-product-name="${product.name}">
                        <input type="number" class="input-field current-weight" placeholder="Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù† Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº" 
                               oninput="calculateProduct(${index})" id="currentWeight${index}">
                    </td>
                    <td>
                        <span class="result-value" id="soldAmount${index}">0</span>
                    </td>
                    <td>
                        <button class="view-entries-btn" onclick="openProductEntriesModal(${index})">ğŸ“‹ Ø§Ù†Ù¹Ø±ÛŒØ² Ø¯ÛŒÚ©Ú¾ÛŒÚº</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
                
                // ÚˆÛŒÙ¹Ø§ Ø§Ø³Ù¹ÙˆØ± Ú©Ø±ÛŒÚº
                if (!salesData[shopId]) salesData[shopId] = [];
                salesData[shopId][index] = {
                    oldWeight: product.oldWeight,
                    newWeight: 0,
                    currentWeight: 0,
                    soldAmount: 0
                };
            });
            
            // Ø§Ø®Ø±Ø§Ø¬Ø§Øª ÚˆÛŒÙ¹Ø§ Ú©Ùˆ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº
            if (!expensesData[shopId]) {
                expensesData[shopId] = {
                    shopRent: 0,
                    electricityBill: 0,
                    salary: 0,
                    iceCreamPurchase: 0,
                    iceCreamPaid: 0,
                    otherExpenses: []
                };
            }
            
            // Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ø§ Ù¾ÛŒÙ†ÚˆÙ†Ú¯ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
            updateIceCreamPurchasePending();
            
            // Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©Ø§ Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
            updateCurrentShopCash();
            
            // ÙÙˆÚ©Ø³ Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº
            currentFocusIndex = 0;
            currentColumn = 0;
        }
        
        // Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©Ø§ Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº - Ø¯Ø±Ø³Øª Ø´Ø¯Û ÙˆØ±Ú˜Ù†
        function updateCurrentShopCash() {
            let currentShopCash = 0;
            
            // Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©Ø§ Ø³ÛŒÙ„Ø² ÚˆÛŒÙ¹Ø§ Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('iceCreamData_')) {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        if (data.shop === currentShop) {
                            currentShopCash += data.totalSale || 0;
                        }
                    } catch (error) {
                        console.error('Error loading sales data:', key, error);
                    }
                }
            }
            
            // Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©Û’ Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ù…Ù†ÙÛŒ Ú©Ø±ÛŒÚº
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('expenseData_')) {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        if (data.shop === currentShop) {
                            // ØªÙ…Ø§Ù… Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ù…Ù†ÙÛŒ Ú©Ø±ÛŒÚº
                            const totalExpense = 
                                (data.expenses.shopRent || 0) +
                                (data.expenses.electricityBill || 0) +
                                (data.expenses.salary || 0) +
                                (data.expenses.iceCreamPaid || 0) +
                                (data.expenses.otherExpenses ? 
                                    data.expenses.otherExpenses.reduce((sum, exp) => sum + (exp.amount || 0), 0) : 0);
                            
                            currentShopCash -= totalExpense;
                        }
                    } catch (error) {
                        console.error('Error loading expense data:', key, error);
                    }
                }
            }
            
            // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ú©ÛŒØ´ Ú©Ùˆ Ù…Ù†ÙÛŒ Ú©Ø±ÛŒÚº (ØµØ±Ù Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©Ø§)
            // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± ÚˆÛŒÙ¹Ø§ Ù…ÛŒÚº Ø´Ø§Ù¾ Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº
            handedOverData.forEach(item => {
                // Ø§Ú¯Ø± ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ù…ÛŒÚº Ø´Ø§Ù¾ Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†ÛÛŒÚº ÛÛ’ ØªÙˆ ØµØ±Ù Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©Ø§ ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ù…Ù†ÙÛŒ Ú©Ø±ÛŒÚº
                if (!item.shop || item.shop === currentShop) {
                    currentShopCash -= item.amount || 0;
                }
            });
            
            document.getElementById('currentShopCash').textContent = currentShopCash + ' Ø±ÙˆÙ¾Û’';
        }
        
        // Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº - Ø§Ù¾ÚˆÛŒÙ¹ Ø´Ø¯Û ÙˆØ±Ú˜Ù†
        function submitExpenses() {
            try {
                if (!expensesData[currentShop]) {
                    expensesData[currentShop] = {
                        shopRent: 0,
                        electricityBill: 0,
                        salary: 0,
                        iceCreamPurchase: 0,
                        iceCreamPaid: 0,
                        otherExpenses: []
                    };
                }
                
                // Ø¨Ù†ÛŒØ§Ø¯ÛŒ Ø§Ø®Ø±Ø§Ø¬Ø§Øª
                expensesData[currentShop].shopRent = parseFloat(document.getElementById('shopRent').value) || 0;
                expensesData[currentShop].electricityBill = parseFloat(document.getElementById('electricityBill').value) || 0;
                expensesData[currentShop].salary = parseFloat(document.getElementById('salary').value) || 0;
                expensesData[currentShop].iceCreamPurchase = parseFloat(document.getElementById('iceCreamPurchase').value) || 0;
                expensesData[currentShop].iceCreamPaid = parseFloat(document.getElementById('iceCreamPaid').value) || 0;
                
                // Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª
                expensesData[currentShop].otherExpenses = [];
                for (let i = 0; i < expenseCounter; i++) {
                    const name = document.getElementById(`expenseName${i}`)?.value;
                    const amount = parseFloat(document.getElementById(`expenseAmount${i}`)?.value) || 0;
                    if (name && amount > 0) {
                        expensesData[currentShop].otherExpenses.push({ name, amount });
                    }
                }
                
                // Ú©Ù„ Ø®Ø±Ú†Û Ú©Ø§ Ø­Ø³Ø§Ø¨
                const totalExpenseAmount = 
                    (expensesData[currentShop].shopRent || 0) +
                    (expensesData[currentShop].electricityBill || 0) +
                    (expensesData[currentShop].salary || 0) +
                    (expensesData[currentShop].iceCreamPaid || 0) +
                    expensesData[currentShop].otherExpenses.reduce((sum, exp) => sum + (exp.amount || 0), 0);
                
                // Ø®Ø±Ú†Û ÚˆÛŒÙ¹Ø§ Ú©Ùˆ ÙÙˆØ±ÛŒ Ø±Ù¾ÙˆØ±Ù¹ Ù…ÛŒÚº Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº
                const expenseData = {
                    shop: currentShop,
                    shopName: shopsData[currentShop].name,
                    date: new Date().toISOString(),
                    expenses: JSON.parse(JSON.stringify(expensesData[currentShop])),
                    totalExpense: totalExpenseAmount, // Ú©Ù„ Ø®Ø±Ú†Û Ø´Ø§Ù…Ù„ Ú©ÛŒØ§
                    timestamp: new Date().getTime(),
                    type: 'expense'
                };
                
                const key = `expenseData_${currentShop}_${new Date().getTime()}`;
                localStorage.setItem(key, JSON.stringify(expenseData));
                
                // Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ ÚˆÛŒÙ¹Ø§ Ú©Ùˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
                if (!iceCreamPurchaseData[currentShop]) {
                    iceCreamPurchaseData[currentShop] = {
                        totalPurchase: 0,
                        totalPaid: 0
                    };
                }
                iceCreamPurchaseData[currentShop].totalPurchase += expensesData[currentShop].iceCreamPurchase || 0;
                iceCreamPurchaseData[currentShop].totalPaid += expensesData[currentShop].iceCreamPaid || 0;
                
                // Ø§Ù† Ù¾Ù¹ ÙÛŒÙ„ÚˆØ² Ø®Ø§Ù„ÛŒ Ú©Ø±ÛŒÚº
                document.getElementById('shopRent').value = '';
                document.getElementById('electricityBill').value = '';
                document.getElementById('salary').value = '';
                document.getElementById('iceCreamPurchase').value = '';
                document.getElementById('iceCreamPaid').value = '';
                
                // Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©Û’ ÙÛŒÙ„ÚˆØ² Ø®Ø§Ù„ÛŒ Ú©Ø±ÛŒÚº
                for (let i = 0; i < expenseCounter; i++) {
                    const nameField = document.getElementById(`expenseName${i}`);
                    const amountField = document.getElementById(`expenseAmount${i}`);
                    if (nameField) nameField.value = '';
                    if (amountField) amountField.value = '';
                }
                
                expenseCounter = 1;
                
                // ÙÙˆØ±ÛŒ Ø·ÙˆØ± Ù¾Ø± Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
                updateCurrentShopCash();
                updateSummary();
                updateIceCreamPurchasePending();
                
                showSuccess('Ø®Ø±Ú†Û Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¬Ù…Ø¹ ÛÙˆ Ú¯ÛŒØ§! Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ Ø§Ù¾ÚˆÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒÛ”');
                closeExpenseModal();
                
            } catch (error) {
                showError('Ø®Ø±Ú†Û Ø¬Ù…Ø¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
            }
        }
        
        // Ù¾Ø±Ø§ÚˆÚ©Ù¹ Ú©Ø§ Ø­Ø³Ø§Ø¨ Ú©ØªØ§Ø¨ - Ù†ÛŒØ§ ÙØ§Ø±Ù…ÙˆÙ„Ø§
        function calculateProduct(index) {
            const newWeight = parseFloat(document.getElementById(`newWeight${index}`).value) || 0;
            const currentWeight = parseFloat(document.getElementById(`currentWeight${index}`).value) || 0;
            const oldWeight = salesData[currentShop][index].oldWeight;

            // Ù†ÛŒØ§ ÙØ§Ø±Ù…ÙˆÙ„Ø§: Ø³ÛŒÙ„ Ú©ÛŒ Ø±Ù‚Ù… = Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† + Ù†ÛŒØ§ ÙˆØ²Ù† - Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù†
            const soldAmount = oldWeight + newWeight - currentWeight;

            // UI Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
            document.getElementById(`soldAmount${index}`).textContent = soldAmount;

            // ÚˆÛŒÙ¹Ø§ Ø§Ø³Ù¹ÙˆØ± Ú©Ø±ÛŒÚº
            salesData[currentShop][index].newWeight = newWeight;
            salesData[currentShop][index].currentWeight = currentWeight;
            salesData[currentShop][index].soldAmount = soldAmount;
            
            updateTotalSale();
            updateSaveButton();
        }
        
        // Ø³ÛŒÙˆ Ø¨Ù¹Ù† Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
        function updateSaveButton() {
            const hasData = salesData[currentShop] && salesData[currentShop].some(product => 
                product.newWeight > 0 || product.currentWeight > 0
            );
            document.getElementById('saveBtn').disabled = !hasData;
        }
        
        // Ú©Ù„ Ø³ÛŒÙ„ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº - ØªÙ…Ø§Ù… Ù¾Ø±Ø§ÚˆÚ©Ù¹Ø³ Ú©ÛŒ Ø³ÛŒÙ„ Ú©ÛŒ Ø±Ù‚Ù… Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº
        function updateTotalSale() {
            let totalSale = 0;
            if (salesData[currentShop]) {
                salesData[currentShop].forEach(product => {
                    totalSale += product.soldAmount > 0 ? product.soldAmount : 0;
                });
            }
            return totalSale;
        }
        
        // Ù¾Ø±Ø§ÚˆÚ©Ù¹ Ø§Ù†Ù¹Ø±ÛŒØ² Ù…ÙˆØ¯Ù„ Ú©Ú¾ÙˆÙ„ÛŒÚº
        function openProductEntriesModal(index) {
            currentViewingProductIndex = index;
            document.getElementById('productEntriesModal').style.display = 'block';
            document.getElementById('productEntriesTitle').textContent = `${shopsData[currentShop].products[index].name} Ú©ÛŒ Ø§Ù†Ù¹Ø±ÛŒØ²`;
            loadProductEntries();
        }
        
        function closeProductEntriesModal() {
            document.getElementById('productEntriesModal').style.display = 'none';
            currentViewingProductIndex = -1;
        }
        
        // Ù¾Ø±Ø§ÚˆÚ©Ù¹ Ø§Ù†Ù¹Ø±ÛŒØ² Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº
        function loadProductEntries() {
            const productName = shopsData[currentShop].products[currentViewingProductIndex].name;
            const productEntries = [];
            
            // ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ Ø³Û’ Ø§Ø³ Ù¾Ø±Ø§ÚˆÚ©Ù¹ Ú©ÛŒ Ø§Ù†Ù¹Ø±ÛŒØ² Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº
            allSavedData.forEach(data => {
                if (data.type === 'sale' && data.shop === currentShop && data.salesData) {
                    const productData = data.salesData[currentViewingProductIndex];
                    if (productData && (productData.soldAmount > 0 || productData.newWeight > 0)) {
                        productEntries.push({
                            date: data.date,
                            oldWeight: productData.oldWeight,
                            newWeight: productData.newWeight,
                            currentWeight: productData.currentWeight,
                            soldAmount: productData.soldAmount,
                            timestamp: data.timestamp,
                            key: data.key
                        });
                    }
                }
            });
            
            // Ø§Ù†Ù¹Ø±ÛŒØ² Ú©Ùˆ ØªØ§Ø±ÛŒØ® Ú©Û’ Ø­Ø³Ø§Ø¨ Ø³Û’ ØªØ±ØªÛŒØ¨ Ø¯ÛŒÚº
            productEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let entriesHTML = '';
            
            if (productEntries.length === 0) {
                entriesHTML = '<p style="text-align: center; color: #636e72; font-size: 1rem; padding: 20px;">Ú©ÙˆØ¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚº ÛÛ’</p>';
            } else {
                entriesHTML = `
                    <h3 style="text-align: center; margin: 15px 0; color: #2d3436;">${productName} Ú©ÛŒ ØªÙ…Ø§Ù… Ø§Ù†Ù¹Ø±ÛŒØ²</h3>
                    <div style="overflow-x: auto;">
                        <table class="entries-table">
                            <thead>
                                <tr>
                                    <th>ØªØ§Ø±ÛŒØ®</th>
                                    <th>Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù†</th>
                                    <th>Ù†ÛŒØ§ ÙˆØ²Ù†</th>
                                    <th>Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù†</th>
                                    <th>Ø³ÛŒÙ„ Ú©ÛŒ Ø±Ù‚Ù…</th>
                                    <th>Ø§ÛŒÚ©Ø´Ù†Ø²</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                productEntries.forEach((entry, index) => {
                    const date = new Date(entry.date).toLocaleDateString('ur-PK');
                    entriesHTML += `
                        <tr>
                            <td>${date}</td>
                            <td>${entry.oldWeight} Ú¯Ø±Ø§Ù…</td>
                            <td>${entry.newWeight} Ú¯Ø±Ø§Ù…</td>
                            <td>${entry.currentWeight} Ú¯Ø±Ø§Ù…</td>
                            <td>${entry.soldAmount} Ú¯Ø±Ø§Ù…</td>
                            <td>
                                <button class="edit-entry-btn-small" onclick="openEditProductEntry('${entry.key}', ${currentViewingProductIndex})">âœï¸</button>
                                <button class="delete-entry-btn" onclick="secureDeleteProductEntry('${entry.key}', ${currentViewingProductIndex})">ğŸ—‘ï¸</button>
                            </td>
                        </tr>
                    `;
                });
                
                entriesHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            document.getElementById('productEntriesContent').innerHTML = entriesHTML;
        }

        // Ù¾Ø±Ø§ÚˆÚ©Ù¹ Ø§Ù†Ù¹Ø±ÛŒ Ø§ÛŒÚˆÙ¹ Ú©Ú¾ÙˆÙ„ÛŒÚº
        function openEditProductEntry(key, productIndex) {
            addPasswordCheck(function() {
                const data = JSON.parse(localStorage.getItem(key));
                if (!data || !data.salesData) return;
                
                const productData = data.salesData[productIndex];
                currentEditingEntry = { key, productIndex };
                
                document.getElementById('editEntryDate').value = data.date.split('T')[0];
                document.getElementById('editEntryNewWeight').value = productData.newWeight || 0;
                document.getElementById('editEntryCurrentWeight').value = productData.currentWeight || 0;
                
                document.getElementById('editEntryModal').style.display = 'block';
            }, 'Ø§Ù†Ù¹Ø±ÛŒ Ø§ÛŒÚˆÙ¹');
        }

        function closeEditEntryModal() {
            document.getElementById('editEntryModal').style.display = 'none';
            currentEditingEntry = null;
        }

        // Ù¾Ø±Ø§ÚˆÚ©Ù¹ Ø§Ù†Ù¹Ø±ÛŒ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
        function updateProductEntry() {
            if (!currentEditingEntry) return;
            
            const date = document.getElementById('editEntryDate').value;
            const newWeight = parseFloat(document.getElementById('editEntryNewWeight').value) || 0;
            const currentWeight = parseFloat(document.getElementById('editEntryCurrentWeight').value) || 0;
            
            if (!date) {
                showError('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ® Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº');
                return;
            }
            
            try {
                const data = JSON.parse(localStorage.getItem(currentEditingEntry.key));
                const oldWeight = data.salesData[currentEditingEntry.productIndex].oldWeight;
                
                // Ø³ÛŒÙ„ Ú©ÛŒ Ø±Ù‚Ù… Ú©Ø§ Ø­Ø³Ø§Ø¨ - Ù†ÛŒØ§ ÙØ§Ø±Ù…ÙˆÙ„Ø§
                const soldAmount = oldWeight + newWeight - currentWeight;
                
                // ÚˆÛŒÙ¹Ø§ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
                data.date = date;
                data.salesData[currentEditingEntry.productIndex].newWeight = newWeight;
                data.salesData[currentEditingEntry.productIndex].currentWeight = currentWeight;
                data.salesData[currentEditingEntry.productIndex].soldAmount = soldAmount;
                
                // Ù„ÙˆÚ©Ù„ Ø§Ø³Ù¹ÙˆØ±ÛŒØ¬ Ù…ÛŒÚº Ø³ÛŒÙˆ Ú©Ø±ÛŒÚº
                localStorage.setItem(currentEditingEntry.key, JSON.stringify(data));
                
                // Ø´Ø§Ù¾ Ú©Ø§ Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
                loadAllSavedData();
                loadShopData(currentShop);
                
                showSuccess('Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒ!');
                closeEditEntryModal();
                closeProductEntriesModal();
            } catch (error) {
                showError('Ø§Ù†Ù¹Ø±ÛŒ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
            }
        }

        // Ù¾Ø±Ø§ÚˆÚ©Ù¹ Ø§Ù†Ù¹Ø±ÛŒ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±ÛŒÚº
        function secureDeleteProductEntry(key, productIndex) {
            addPasswordCheck(function() {
                if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ ÛŒÛ Ø§Ù†Ù¹Ø±ÛŒ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                    try {
                        localStorage.removeItem(key);
                        
                        // Ø´Ø§Ù¾ Ú©Ø§ Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
                        loadAllSavedData();
                        loadShopData(currentShop);
                        
                        showSuccess('Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ ÚˆÛŒÙ„ÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒ!');
                        loadProductEntries();
                    } catch (error) {
                        showError('Ø§Ù†Ù¹Ø±ÛŒ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
                    }
                }
            }, 'Ø§Ù†Ù¹Ø±ÛŒ ÚˆÛŒÙ„ÛŒÙ¹');
        }

        // Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©ÛŒ Ø§Ù†Ù¹Ø±ÛŒØ² Ø¯ÛŒÚ©Ú¾ÛŒÚº
        function openExpenseEntriesModal() {
            document.getElementById('expenseEntriesModal').style.display = 'block';
            loadExpenseEntries();
        }

        function closeExpenseEntriesModal() {
            document.getElementById('expenseEntriesModal').style.display = 'none';
        }

        // Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©ÛŒ Ø§Ù†Ù¹Ø±ÛŒØ² Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº
        function loadExpenseEntries() {
            const expenseEntries = [];
            
            // ØªÙ…Ø§Ù… Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©ÛŒ ÚˆÛŒÙ¹Ø§ Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('expenseData_')) {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        expenseEntries.push({...data, key: key});
                    } catch (error) {
                        console.error('Error loading expense entry:', key, error);
                    }
                }
            }
            
            // Ø§Ù†Ù¹Ø±ÛŒØ² Ú©Ùˆ ØªØ§Ø±ÛŒØ® Ú©Û’ Ø­Ø³Ø§Ø¨ Ø³Û’ ØªØ±ØªÛŒØ¨ Ø¯ÛŒÚº
            expenseEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let entriesHTML = '';
            
            if (expenseEntries.length === 0) {
                entriesHTML = '<p style="text-align: center; color: #636e72; font-size: 1rem; padding: 20px;">Ú©ÙˆØ¦ÛŒ Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚº ÛÛ’</p>';
            } else {
                entriesHTML = `
                    <h3 style="text-align: center; margin: 15px 0; color: #2d3436;">Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©ÛŒ ØªÙ…Ø§Ù… Ø§Ù†Ù¹Ø±ÛŒØ²</h3>
                    <div style="overflow-x: auto;">
                        <table class="entries-table">
                            <thead>
                                <tr>
                                    <th>ØªØ§Ø±ÛŒØ®</th>
                                    <th>Ø´Ø§Ù¾</th>
                                    <th>Ø´Ø§Ù¾ Ú©Ø±Ø§ÛŒÛ</th>
                                    <th>Ø¨Ø¬Ù„ÛŒ Ú©Ø§ Ø¨Ù„</th>
                                    <th>ØªÙ†Ø®ÙˆØ§Û</th>
                                    <th>Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ…</th>
                                    <th>Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</th>
                                    <th>Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª</th>
                                    <th>Ø§ÛŒÚ©Ø´Ù†Ø²</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                expenseEntries.forEach((entry, index) => {
                    const date = new Date(entry.date).toLocaleDateString('ur-PK');
                    const otherExpensesTotal = entry.expenses.otherExpenses ? 
                        entry.expenses.otherExpenses.reduce((sum, exp) => sum + (exp.amount || 0), 0) : 0;
                    const otherExpensesText = entry.expenses.otherExpenses ? 
                        entry.expenses.otherExpenses.map(exp => `${exp.name}: ${exp.amount}`).join(', ') : '---';
                    
                    entriesHTML += `
                        <tr>
                            <td>${date}</td>
                            <td>${entry.shopName}</td>
                            <td>${entry.expenses.shopRent || 0} Ø±ÙˆÙ¾Û’</td>
                            <td>${entry.expenses.electricityBill || 0} Ø±ÙˆÙ¾Û’</td>
                            <td>${entry.expenses.salary || 0} Ø±ÙˆÙ¾Û’</td>
                            <td>${entry.expenses.iceCreamPurchase || 0} Ø±ÙˆÙ¾Û’</td>
                            <td>${entry.expenses.iceCreamPaid || 0} Ø±ÙˆÙ¾Û’</td>
                            <td title="${otherExpensesText}">${otherExpensesTotal} Ø±ÙˆÙ¾Û’</td>
                            <td>
                                <button class="edit-entry-btn-small" onclick="openEditExpenseEntry('${entry.key}')">âœï¸</button>
                                <button class="delete-entry-btn" onclick="secureDeleteExpenseEntry('${entry.key}')">ğŸ—‘ï¸</button>
                            </td>
                        </tr>
                    `;
                });
                
                entriesHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            document.getElementById('expenseEntriesContent').innerHTML = entriesHTML;
        }

        // Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø§Ù†Ù¹Ø±ÛŒ Ø§ÛŒÚˆÙ¹ Ú©Ú¾ÙˆÙ„ÛŒÚº
        function openEditExpenseEntry(key) {
            addPasswordCheck(function() {
                const data = JSON.parse(localStorage.getItem(key));
                if (!data) return;
                
                currentEditingExpenseEntry = key;
                
                document.getElementById('editExpenseDate').value = data.date.split('T')[0];
                document.getElementById('editShopRent').value = data.expenses.shopRent || 0;
                document.getElementById('editElectricityBill').value = data.expenses.electricityBill || 0;
                document.getElementById('editSalary').value = data.expenses.salary || 0;
                document.getElementById('editIceCreamPurchase').value = data.expenses.iceCreamPurchase || 0;
                document.getElementById('editIceCreamPaid').value = data.expenses.iceCreamPaid || 0;
                
                // Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©Û’ ÙÛŒÙ„ÚˆØ² Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº
                const container = document.getElementById('editOtherExpensesContainer');
                container.innerHTML = '';
                
                if (data.expenses.otherExpenses && data.expenses.otherExpenses.length > 0) {
                    data.expenses.otherExpenses.forEach((expense, index) => {
                        const newField = `
                            <div class="expense-item">
                                <input type="text" class="expense-input" placeholder="Ø®Ø±Ú†Û’ Ú©Ø§ Ù†Ø§Ù…" 
                                       id="editExpenseName${index}" value="${expense.name || ''}">
                                <input type="number" class="expense-input" placeholder="Ø±Ù‚Ù…" 
                                       id="editExpenseAmount${index}" value="${expense.amount || 0}">
                            </div>
                        `;
                        container.insertAdjacentHTML('beforeend', newField);
                    });
                    editExpenseCounter = data.expenses.otherExpenses.length;
                } else {
                    editExpenseCounter = 0;
                    addEditExpenseField();
                }
                
                document.getElementById('editExpenseModal').style.display = 'block';
            }, 'Ø®Ø±Ú†Û Ø§ÛŒÚˆÙ¹');
        }

        function closeEditExpenseModal() {
            document.getElementById('editExpenseModal').style.display = 'none';
            currentEditingExpenseEntry = null;
        }

        // Ø§ÛŒÚˆÙ¹ Ø§Ø®Ø±Ø§Ø¬Ø§Øª ÙÛŒÙ„Úˆ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº
        function addEditExpenseField() {
            const container = document.getElementById('editOtherExpensesContainer');
            const newField = `
                <div class="expense-item">
                    <input type="text" class="expense-input" placeholder="Ø®Ø±Ú†Û’ Ú©Ø§ Ù†Ø§Ù…" id="editExpenseName${editExpenseCounter}">
                    <input type="number" class="expense-input" placeholder="Ø±Ù‚Ù…" id="editExpenseAmount${editExpenseCounter}">
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newField);
            editExpenseCounter++;
        }

        // Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø§Ù†Ù¹Ø±ÛŒ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
        function updateExpenseEntry() {
            if (!currentEditingExpenseEntry) return;
            
            const date = document.getElementById('editExpenseDate').value;
            const shopRent = parseFloat(document.getElementById('editShopRent').value) || 0;
            const electricityBill = parseFloat(document.getElementById('editElectricityBill').value) || 0;
            const salary = parseFloat(document.getElementById('editSalary').value) || 0;
            const iceCreamPurchase = parseFloat(document.getElementById('editIceCreamPurchase').value) || 0;
            const iceCreamPaid = parseFloat(document.getElementById('editIceCreamPaid').value) || 0;
            
            if (!date) {
                showError('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ® Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº');
                return;
            }
            
            try {
                const data = JSON.parse(localStorage.getItem(currentEditingExpenseEntry));
                
                // Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº
                const otherExpenses = [];
                for (let i = 0; i < editExpenseCounter; i++) {
                    const name = document.getElementById(`editExpenseName${i}`)?.value;
                    const amount = parseFloat(document.getElementById(`editExpenseAmount${i}`)?.value) || 0;
                    if (name && amount > 0) {
                        otherExpenses.push({ name, amount });
                    }
                }
                
                // ÚˆÛŒÙ¹Ø§ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
                data.date = date;
                data.expenses = {
                    shopRent,
                    electricityBill,
                    salary,
                    iceCreamPurchase,
                    iceCreamPaid,
                    otherExpenses
                };
                
                // Ù„ÙˆÚ©Ù„ Ø§Ø³Ù¹ÙˆØ±ÛŒØ¬ Ù…ÛŒÚº Ø³ÛŒÙˆ Ú©Ø±ÛŒÚº
                localStorage.setItem(currentEditingExpenseEntry, JSON.stringify(data));
                
                // Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ ÚˆÛŒÙ¹Ø§ Ú©Ùˆ Ø±ÛŒÙØ±ÛŒØ´ Ú©Ø±ÛŒÚº
                loadAllSavedData();
                updateIceCreamPurchasePending();
                
                showSuccess('Ø®Ø±Ú†Û Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ ÛÙˆ Ú¯ÛŒØ§!');
                closeEditExpenseModal();
                closeExpenseEntriesModal();
            } catch (error) {
                showError('Ø®Ø±Ú†Û Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
            }
        }

        // Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø§Ù†Ù¹Ø±ÛŒ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±ÛŒÚº
        function secureDeleteExpenseEntry(key) {
            addPasswordCheck(function() {
                if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ ÛŒÛ Ø®Ø±Ú†Û Ø§Ù†Ù¹Ø±ÛŒ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        
                        // Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ ÚˆÛŒÙ¹Ø§ Ø³Û’ ÛÙ¹Ø§Ø¦ÛŒÚº
                        if (data.shop && data.expenses) {
                            if (iceCreamPurchaseData[data.shop]) {
                                iceCreamPurchaseData[data.shop].totalPurchase -= data.expenses.iceCreamPurchase || 0;
                                iceCreamPurchaseData[data.shop].totalPaid -= data.expenses.iceCreamPaid || 0;
                            }
                        }
                        
                        localStorage.removeItem(key);
                        
                        showSuccess('Ø®Ø±Ú†Û Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ ÚˆÛŒÙ„ÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒ!');
                        loadExpenseEntries();
                        updateIceCreamPurchasePending();
                    } catch (error) {
                        showError('Ø®Ø±Ú†Û Ø§Ù†Ù¹Ø±ÛŒ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
                    }
                }
            }, 'Ø®Ø±Ú†Û ÚˆÛŒÙ„ÛŒÙ¹');
        }

        // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ø§Ù†Ù¹Ø±ÛŒ Ø§ÛŒÚˆÙ¹ Ú©Ú¾ÙˆÙ„ÛŒÚº
        function editHandedOverEntry(key) {
            addPasswordCheck(function() {
                const data = JSON.parse(localStorage.getItem(key));
                if (!data) return;
                
                currentEditingHandedOverEntry = key;
                
                document.getElementById('editHandedOverDate').value = data.date;
                document.getElementById('editHandedOverAmount').value = data.amount || 0;
                document.getElementById('editHandedOverDescription').value = data.description || '';
                
                document.getElementById('editHandedOverModal').style.display = 'block';
            }, 'ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ø§ÛŒÚˆÙ¹');
        }

        function closeEditHandedOverModal() {
            document.getElementById('editHandedOverModal').style.display = 'none';
            currentEditingHandedOverEntry = null;
        }

        // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ø§Ù†Ù¹Ø±ÛŒ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº - Ø¯Ø±Ø³Øª Ø´Ø¯Û ÙˆØ±Ú˜Ù†
        function updateHandedOverEntry() {
            if (!currentEditingHandedOverEntry) return;
            
            const date = document.getElementById('editHandedOverDate').value;
            const amount = parseFloat(document.getElementById('editHandedOverAmount').value) || 0;
            const description = document.getElementById('editHandedOverDescription').value || 'ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ±';
            
            if (!date || amount <= 0) {
                showError('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø¯Ø±Ø³Øª ØªØ§Ø±ÛŒØ® Ø§ÙˆØ± Ø±Ù‚Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº');
                return;
            }
            
            try {
                const data = JSON.parse(localStorage.getItem(currentEditingHandedOverEntry));
                
                // ÚˆÛŒÙ¹Ø§ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
                data.date = date;
                data.amount = amount;
                data.description = description;
                data.shop = currentShop; // Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº
                
                // Ù„ÙˆÚ©Ù„ Ø§Ø³Ù¹ÙˆØ±ÛŒØ¬ Ù…ÛŒÚº Ø³ÛŒÙˆ Ú©Ø±ÛŒÚº
                localStorage.setItem(currentEditingHandedOverEntry, JSON.stringify(data));
                
                // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± ÚˆÛŒÙ¹Ø§ Ú©Ùˆ Ø±ÛŒÙØ±ÛŒØ´ Ú©Ø±ÛŒÚº
                loadAllSavedData();
                updateSummary();
                
                showSuccess('ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ ÛÙˆ Ú¯ÛŒØ§!');
                closeEditHandedOverModal();
                toggleHandedOverDetails();
            } catch (error) {
                showError('ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
            }
        }

        // ØªÙ…Ø§Ù… ÚˆÛŒÙ„ÛŒÙ¹ Ù…ÙˆØ¯Ù„ Ú©Ú¾ÙˆÙ„ÛŒÚº
        function openDeleteAllModal() {
            document.getElementById('deleteAllModal').style.display = 'block';
            document.getElementById('deleteAllPassword').value = '';
        }
        
        function closeDeleteAllModal() {
            document.getElementById('deleteAllModal').style.display = 'none';
        }
        
        // ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±ÛŒÚº
        function confirmDeleteAll() {
            const password = document.getElementById('deleteAllPassword').value;
            
            if (password === SYSTEM_PASSWORD) {
                if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ ÛŒÛ Ø¹Ù…Ù„ ÙˆØ§Ù¾Ø³ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©Û’ Ú¯Ø§!')) {
                    showLoading(true);
                    try {
                        // ØªÙ…Ø§Ù… Ù„ÙˆÚ©Ù„ Ø§Ø³Ù¹ÙˆØ±ÛŒØ¬ ÚˆÛŒÙ¹Ø§ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±ÛŒÚº
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (key.startsWith('iceCreamData_') || key.startsWith('handedOver_') || key.startsWith('expenseData_')) {
                                localStorage.removeItem(key);
                            }
                        }
                        
                        // ØªÙ…Ø§Ù… Ú¯Ù„ÙˆØ¨Ù„ ÙˆÛŒØ±ÛŒ Ø§ÛŒØ¨Ù„Ø² Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº
                        allSavedData = [];
                        handedOverData = [];
                        iceCreamPurchaseData = {};
                        expensesData = {};
                        salesData = {};
                        
                        // ØªÙ…Ø§Ù… Ø´Ø§Ù¾Ø³ Ú©Û’ Ù¾Ø±Ø§Ù†Û’ ÙˆØ²Ù† Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº
                        Object.keys(shopsData).forEach(shopId => {
                            shopsData[shopId].products.forEach(product => {
                                product.oldWeight = 0;
                            });
                        });
                        
                        // Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©Ø§ ÚˆÛŒÙ¹Ø§ Ø±ÛŒ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº
                        loadShopData(currentShop);
                        updateSummary();
                        updateCurrentShopCash();
                        
                        showSuccess('ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ ÚˆÛŒÙ„ÛŒÙ¹ ÛÙˆ Ú¯ÛŒØ§!');
                    } catch (error) {
                        showError('ÚˆÛŒÙ¹Ø§ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
                    } finally {
                        showLoading(false);
                        closeDeleteAllModal();
                    }
                }
            } else {
                showError('ØºÙ„Ø· Ù¾Ø§Ø³ ÙˆØ±Úˆ!');
            }
        }
        
        // Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ù¾ÛŒÙ†ÚˆÙ†Ú¯ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
        function updateIceCreamPurchasePending() {
            const shopData = iceCreamPurchaseData[currentShop] || { totalPurchase: 0, totalPaid: 0 };
            const pending = shopData.totalPurchase - shopData.totalPaid;
            
            document.getElementById('iceCreamPending').textContent = pending + ' Ø±ÙˆÙ¾Û’';
            document.getElementById('iceCreamPendingDisplay').textContent = pending + ' Ø±ÙˆÙ¾Û’';
            
            if (pending > 0) {
                document.getElementById('iceCreamPendingDisplay').className = 'purchase-pending';
            } else {
                document.getElementById('iceCreamPendingDisplay').className = 'purchase-paid';
            }
        }
        
        // Ø®ÙˆØ¯Ú©Ø§Ø± Ú©ÛŒØ´ Ú©ÛŒÙ„Ú©ÙˆÙ„ÛŒØ´Ù† - ØªÙ…Ø§Ù… Ø³ÛŒÙ„ Ú©ÛŒ Ø±Ù‚Ù… Ø¬Ù…Ø¹ Ú©Ø± Ú©Û’ Ø¯Ú©Ú¾Ø§Ø¦Û’
        function autoCalculateCash() {
            const totalSale = updateTotalSale();
            document.getElementById('totalCash').value = totalSale;
            updateCashComparison();
        }
        
        // Ú©ÛŒØ´ Ù…ÙˆØ§Ø²Ù†Û Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
        function updateCashComparison() {
            const totalCash = parseFloat(document.getElementById('totalCash').value) || 0;
            const totalSale = updateTotalSale();
            
            const difference = totalCash - totalSale;
            const comparisonResult = document.getElementById('comparisonResult');
            
            if (totalCash === 0) {
                comparisonResult.textContent = 'Ø¨Ø±Ø§Û Ú©Ø±Ù… Ú©ÛŒØ´ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº';
                comparisonResult.className = 'comparison-result comparison-equal';
            } else if (difference === 0) {
                comparisonResult.textContent = 'âœ… Ú©ÛŒØ´ Ø¨Ø§Ù„Ú©Ù„ ØµØ­ÛŒØ­ ÛÛ’';
                comparisonResult.className = 'comparison-result comparison-equal';
            } else if (difference > 0) {
                comparisonResult.textContent = `â• ${difference} Ø±ÙˆÙ¾Û’ Ø²ÛŒØ§Ø¯Û ÛÛŒÚº`;
                comparisonResult.className = 'comparison-result comparison-positive';
            } else {
                comparisonResult.textContent = `â– ${Math.abs(difference)} Ø±ÙˆÙ¾Û’ Ú©Ù… ÛÛŒÚº`;
                comparisonResult.className = 'comparison-result comparison-negative';
            }
        }
        
        // Ø®Ø±Ú†Û ÙÛŒÙ„Úˆ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº
        function addExpenseField() {
            const container = document.getElementById('otherExpensesContainer');
            const newField = `
                <div class="expense-item">
                    <input type="text" class="expense-input" placeholder="Ø®Ø±Ú†Û’ Ú©Ø§ Ù†Ø§Ù…" id="expenseName${expenseCounter}">
                    <input type="number" class="expense-input" placeholder="Ø±Ù‚Ù…" id="expenseAmount${expenseCounter}">
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newField);
            expenseCounter++;
        }
        
        // Ø³Ø§Ø±Ø§ ÚˆÛŒÙ¹Ø§ Ø³ÛŒÙˆ Ú©Ø±ÛŒÚº - Ø§Ù¾ÚˆÛŒÙ¹ Ø´Ø¯Û ÙˆØ±Ú˜Ù†
        function saveAllData() {
            try {
                const totalCash = parseFloat(document.getElementById('totalCash').value) || 0;
                const totalSale = updateTotalSale();
                
                // Ø¯Ø±Ø³Øª Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ Ú©Ø§ Ø­Ø³Ø§Ø¨: Ú©Ù„ Ø³ÛŒÙ„ - Ø§Ø®Ø±Ø§Ø¬Ø§Øª
                const totalExpenses = calculateTotalExpenses();
                const cashInHand = totalSale - totalExpenses;
                
                const saveData = {
                    shop: currentShop,
                    shopName: shopsData[currentShop].name,
                    date: new Date().toISOString(),
                    salesData: JSON.parse(JSON.stringify(salesData[currentShop])),
                    totalSale: totalSale,
                    totalCash: totalCash,
                    expenses: expensesData[currentShop],
                    cashInHand: cashInHand, // Ø¯Ø±Ø³Øª Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ
                    timestamp: new Date().getTime(),
                    type: 'sale'
                };
                
                // ÚˆÛŒÙ¹Ø§ ÙˆØ§Ù„ÛŒÚˆÛŒØ´Ù†
                const validationErrors = validateSalesData(saveData);
                if (validationErrors.length > 0) {
                    showError('Ø¯Ø±Ø¬ Ø°ÛŒÙ„ ØºÙ„Ø·ÛŒØ§Úº ÛÛŒÚº:\n' + validationErrors.join('\n'));
                    return;
                }
                
                // Ù„ÙˆÚ©Ù„ Ø§Ø³Ù¹ÙˆØ±ÛŒØ¬ Ù…ÛŒÚº Ø³ÛŒÙˆ Ú©Ø±ÛŒÚº
                const key = `iceCreamData_${currentShop}_${new Date().getTime()}`;
                localStorage.setItem(key, JSON.stringify(saveData));
                
                // ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ Ú©ÛŒ ÙÛØ±Ø³Øª Ù…ÛŒÚº Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº
                allSavedData.push(saveData);
                
                resetDataAfterSave();
                updateSummary();
                updateCurrentShopCash();
                showNotification(`âœ… ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø³ÛŒÙˆ ÛÙˆ Ú¯ÛŒØ§!\n\nØ´Ø§Ù¾: ${shopsData[currentShop].name}\nÚ©Ù„ Ø³ÛŒÙ„: ${totalSale} Ú¯Ø±Ø§Ù…\nÚ©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ: ${cashInHand} Ø±ÙˆÙ¾Û’`);
            } catch (error) {
                showError('ÚˆÛŒÙ¹Ø§ Ø³ÛŒÙˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
            }
        }
        
        // ÚˆÛŒÙ¹Ø§ Ú©Ùˆ Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº Ø³ÛŒÙˆ Ú©Û’ Ø¨Ø¹Ø¯
        function resetDataAfterSave() {
            const shop = shopsData[currentShop];
            
            // Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† Ú©Ùˆ Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù† Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
            shop.products.forEach((product, index) => {
                if (salesData[currentShop] && salesData[currentShop][index]) {
                    // Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù† Ú©Ùˆ Ù†ÛŒØ§ Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† Ø¨Ù†Ø§Ø¦ÛŒÚº
                    product.oldWeight = salesData[currentShop][index].currentWeight;
                    
                    // Ø³ÛŒÙ„Ø² ÚˆÛŒÙ¹Ø§ Ù…ÛŒÚº Ø¨Ú¾ÛŒ Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
                    salesData[currentShop][index].oldWeight = salesData[currentShop][index].currentWeight;
                }
            });
            
            // ØªÙ…Ø§Ù… ÙÛŒÙ„ÚˆØ² Ú©Ùˆ Ø®Ø§Ù„ÛŒ Ú©Ø±ÛŒÚº
            document.querySelectorAll('.new-weight').forEach(input => {
                input.value = '';
            });
            
            document.querySelectorAll('.current-weight').forEach(input => {
                input.value = '';
            });
            
            // Ø³ÛŒÙ„ Ú©ÛŒ Ø±Ù‚Ù… Ú©Ùˆ Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº
            document.querySelectorAll('[id^="soldAmount"]').forEach(span => {
                span.textContent = '0';
            });
            
            // Ú©ÛŒØ´ ÙÛŒÙ„ÚˆØ² Ú©Ùˆ Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº
            document.getElementById('totalCash').value = '';
            
            // Ø³ÛŒÙˆ Ø¨Ù¹Ù† Ú©Ùˆ ÚˆØ³ Ø§ÛŒØ¨Ù„ Ú©Ø±ÛŒÚº
            document.getElementById('saveBtn').disabled = true;
            
            // Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† Ú©Ùˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº UI Ù…ÛŒÚº
            document.querySelectorAll('.old-weight').forEach((input, index) => {
                if (shop.products[index]) {
                    input.value = shop.products[index].oldWeight;
                }
            });
            
            // Ø³ÛŒÙ„Ø² ÚˆÛŒÙ¹Ø§ Ú©Ùˆ Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº (Ù„ÛŒÚ©Ù† Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† Ú©Ùˆ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø±Ú©Ú¾ÛŒÚº)
            if (salesData[currentShop]) {
                salesData[currentShop].forEach((product, index) => {
                    product.newWeight = 0;
                    product.currentWeight = 0;
                    product.soldAmount = 0;
                });
            }
            
            // ÙÙˆÚ©Ø³ Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº
            currentFocusIndex = 0;
            currentColumn = 0;
            document.querySelectorAll('.current-input').forEach(el => {
                el.classList.remove('current-input');
            });
            
            updateCashComparison();
        }
        
        // Ú©Ù„ Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©Ø§ Ø­Ø³Ø§Ø¨
        function calculateTotalExpenses() {
            const shopExpenses = expensesData[currentShop];
            if (!shopExpenses) return 0;
            
            const fixedExpenses = shopExpenses.shopRent + shopExpenses.electricityBill + 
                                shopExpenses.salary + shopExpenses.iceCreamPaid;
            
            let otherExpensesTotal = 0;
            shopExpenses.otherExpenses.forEach(expense => {
                otherExpensesTotal += expense.amount || 0;
            });
            
            return fixedExpenses + otherExpensesTotal;
        }
        
        // Ø³Ù…Ø±ÛŒ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº - Ø¯Ø±Ø³Øª Ø´Ø¯Û ÙˆØ±Ú˜Ù†
        function updateSummary() {
            let totalHandedOver = 0;
            let currentCashInHand = 0;
            
            // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± ÚˆÛŒÙ¹Ø§ Ú©Ø§ Ø­Ø³Ø§Ø¨ (ØµØ±Ù Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©Ø§)
            handedOverData.forEach(item => {
                if (!item.shop || item.shop === currentShop) {
                    totalHandedOver += item.amount || 0;
                }
            });
            
            // Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©Ø§ Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('iceCreamData_')) {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        if (data.shop === currentShop) {
                            // Ø¯Ø±Ø³Øª Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ Ú©Ø§ Ø­Ø³Ø§Ø¨: Ú©Ù„ Ø³ÛŒÙ„ - Ø§Ø®Ø±Ø§Ø¬Ø§Øª
                            const totalExpenses = calculateTotalExpensesForShop(data);
                            currentCashInHand += (data.totalSale || 0) - totalExpenses;
                        }
                    } catch (error) {
                        console.error('Error loading cash data:', key, error);
                    }
                }
            }
            
            // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ú©ÛŒØ´ Ú©Ùˆ Ù…Ù†ÙÛŒ Ú©Ø±ÛŒÚº (ØµØ±Ù Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©Ø§)
            currentCashInHand -= totalHandedOver;
            
            document.getElementById('totalHandedOver').textContent = totalHandedOver + ' Ø±ÙˆÙ¾Û’';
            document.getElementById('currentCashInHand').textContent = currentCashInHand + ' Ø±ÙˆÙ¾Û’';
            
            // Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ù¾ÛŒÙ†ÚˆÙ†Ú¯ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
            updateIceCreamPurchasePending();
        }
        
        // Ù…Ø®ØµÙˆØµ Ø´Ø§Ù¾ Ú©Û’ Ú©Ù„ Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©Ø§ Ø­Ø³Ø§Ø¨
        function calculateTotalExpensesForShop(data) {
            if (!data.expenses) return 0;
            
            const shopExpenses = data.expenses;
            const fixedExpenses = (shopExpenses.shopRent || 0) + (shopExpenses.electricityBill || 0) + 
                                (shopExpenses.salary || 0) + (shopExpenses.iceCreamPaid || 0);
            
            let otherExpensesTotal = 0;
            if (shopExpenses.otherExpenses) {
                shopExpenses.otherExpenses.forEach(expense => {
                    otherExpensesTotal += expense.amount || 0;
                });
            }
            
            return fixedExpenses + otherExpensesTotal;
        }
        
        // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± ÚˆÛŒÙ¹ÛŒÙ„Ø² Ù¹ÙˆÚ¯Ù„ Ú©Ø±ÛŒÚº - Ø¯Ø±Ø³Øª Ø´Ø¯Û ÙˆØ±Ú˜Ù†
        function toggleHandedOverDetails() {
            const handedOverDetails = document.getElementById('handedOverDetails');
            const content = document.getElementById('handedOverDetailsContent');
            
            if (handedOverDetails.style.display === 'block') {
                handedOverDetails.style.display = 'none';
            } else {
                let detailsHTML = '';
                let currentShopHandedOver = handedOverData.filter(item => !item.shop || item.shop === currentShop);
                
                if (currentShopHandedOver.length === 0) {
                    detailsHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7); padding: 10px;">Ú©ÙˆØ¦ÛŒ ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ø±ÛŒÚ©Ø§Ø±Úˆ Ù†ÛÛŒÚº ÛÛ’</p>';
                } else {
                    currentShopHandedOver.forEach((item, index) => {
                        const date = new Date(item.date).toLocaleDateString('ur-PK');
                        detailsHTML += `
                            <div class="handed-over-item">
                                <div>
                                    <span>${date}</span>
                                    <span style="margin-right: 8px;">- ${item.description || 'ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ±'}</span>
                                </div>
                                <div>
                                    <button class="edit-entry-btn" onclick="editHandedOverEntry('${item.key}')">âœï¸</button>
                                    <span>${item.amount} Ø±ÙˆÙ¾Û’</span>
                                </div>
                            </div>
                        `;
                    });
                }
                
                content.innerHTML = detailsHTML;
                handedOverDetails.style.display = 'block';
            }
        }
        
        // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ù…ÙˆØ¯Ù„ Ú©Ú¾ÙˆÙ„ÛŒÚº
        function openHandedOverModal() {
            document.getElementById('handedOverDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('handedOverAmount').value = '';
            document.getElementById('handedOverDescription').value = '';
            document.getElementById('handedOverModal').style.display = 'block';
        }
        
        function closeHandedOverModal() {
            document.getElementById('handedOverModal').style.display = 'none';
        }
        
        // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº - Ø¯Ø±Ø³Øª Ø´Ø¯Û ÙˆØ±Ú˜Ù†
        function submitHandedOver() {
            try {
                const date = document.getElementById('handedOverDate').value;
                const amount = parseFloat(document.getElementById('handedOverAmount').value) || 0;
                const description = document.getElementById('handedOverDescription').value || 'ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ±';
                
                if (!date || amount <= 0) {
                    showError('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø¯Ø±Ø³Øª ØªØ§Ø±ÛŒØ® Ø§ÙˆØ± Ø±Ù‚Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº');
                    return;
                }
                
                const handedOverDataItem = {
                    date: date,
                    amount: amount,
                    description: description,
                    shop: currentShop, // Ù…ÙˆØ¬ÙˆØ¯Û Ø´Ø§Ù¾ Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº
                    timestamp: new Date().getTime()
                };
                
                const key = `handedOver_${currentShop}_${new Date().getTime()}`;
                localStorage.setItem(key, JSON.stringify(handedOverDataItem));
                
                handedOverData.push({...handedOverDataItem, key: key});
                handedOverData.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                showSuccess('ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ú©ÛŒØ´ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¬Ù…Ø¹ ÛÙˆ Ú¯ÛŒØ§!');
                closeHandedOverModal();
                updateSummary();
                updateCurrentShopCash();
                toggleHandedOverDetails();
            } catch (error) {
                showError('ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ø¬Ù…Ø¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
            }
        }
        
        // ÙˆØ²Ù† Ø§ÛŒÚˆÙ¹ Ù…ÙˆØ¯Ù„ ÙÙ†Ú©Ø´Ù†Ø²
        function openEditWeightModal(index) {
            currentEditingProductIndex = index;
            document.getElementById('editWeightModal').style.display = 'block';
            document.getElementById('editWeightPassword').value = '';
        }
        
        function closeEditWeightModal() {
            document.getElementById('editWeightModal').style.display = 'none';
            currentEditingProductIndex = -1;
        }
        
        function confirmEditWeight() {
            const password = document.getElementById('editWeightPassword').value;
            
            if (password === SYSTEM_PASSWORD) {
                const newWeight = prompt('Ù†ÛŒØ§ Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº (Ú¯Ø±Ø§Ù… Ù…ÛŒÚº):');
                if (newWeight !== null && !isNaN(newWeight)) {
                    const weightValue = parseFloat(newWeight);
                    shopsData[currentShop].products[currentEditingProductIndex].oldWeight = weightValue;
                    salesData[currentShop][currentEditingProductIndex].oldWeight = weightValue;
                    
                    // UI Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
                    document.querySelectorAll('.old-weight')[currentEditingProductIndex].value = weightValue;
                    
                    showSuccess('Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ ØªØ¨Ø¯ÛŒÙ„ ÛÙˆ Ú¯ÛŒØ§!');
                    closeEditWeightModal();
                }
            } else {
                showError('ØºÙ„Ø· Ù¾Ø§Ø³ ÙˆØ±Úˆ!');
            }
        }
        
        // Ù†Ø¦ÛŒ Ø´Ø§Ù¾ Ø§ÛŒÚˆ Ú©Ø±Ù†Û’ Ú©Ø§ Ø³Ø³Ù¹Ù…
        function openAddShopModal() {
            addPasswordCheck(function() {
                document.getElementById('addShopModal').style.display = 'block';
                document.getElementById('newShopName').value = '';
                document.getElementById('newShopId').value = '';
            }, 'Ù†Ø¦ÛŒ Ø´Ø§Ù¾ Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Ø§');
        }
        
        function closeAddShopModal() {
            document.getElementById('addShopModal').style.display = 'none';
        }
        
        function addNewShop() {
            const shopName = document.getElementById('newShopName').value;
            const shopId = document.getElementById('newShopId').value;
            
            if (!shopName || !shopId) {
                showError('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø´Ø§Ù¾ Ú©Ø§ Ù†Ø§Ù… Ø§ÙˆØ± Ø¢Ø¦ÛŒ ÚˆÛŒ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº');
                return;
            }
            
            if (shopsData[shopId]) {
                showError('ÛŒÛ Ø´Ø§Ù¾ Ø¢Ø¦ÛŒ ÚˆÛŒ Ù¾ÛÙ„Û’ Ø³Û’ Ù…ÙˆØ¬ÙˆØ¯ ÛÛ’');
                return;
            }
            
            // Ù†Ø¦ÛŒ Ø´Ø§Ù¾ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº
            shopsData[shopId] = {
                name: shopName,
                products: JSON.parse(JSON.stringify(shopsData.delhi.products)) // ÚˆÛŒÙØ§Ù„Ù¹ Ù¾Ø±Ø§ÚˆÚ©Ù¹Ø³
            };
            
            // Ø´Ø§Ù¾ Ø³Ù„ÛŒÚ©Ù¹Ø± Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
            updateShopSelector();
            
            showSuccess('Ù†Ø¦ÛŒ Ø´Ø§Ù¾ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯Ø¦ÛŒ!');
            closeAddShopModal();
        }
        
        // Ù…ÙˆØ¯Ù„ ÙÙ†Ú©Ø´Ù†Ø²
        function openExpenseModal() {
            document.getElementById('expenseShopName').textContent = shopsData[currentShop].name;
            document.getElementById('expenseModal').style.display = 'block';
        }
        
        function closeExpenseModal() {
            document.getElementById('expenseModal').style.display = 'none';
        }
        
        function openReportModal() {
            document.getElementById('reportModal').style.display = 'block';
            // Ø±Ù¾ÙˆØ±Ù¹ Ù…ÙˆØ¯Ù„ Ú©Ú¾Ù„ØªÛ’ ÛÛŒ ØªØ§Ø²Û Ø±Ù¾ÙˆØ±Ù¹ Ø¯Ú©Ú¾Ø§Ø¦ÛŒÚº
            generateReport();
        }
        
        function closeReportModal() {
            document.getElementById('reportModal').style.display = 'none';
        }
        
        // Ø®Ø±Ú†Û Ù…ÙˆØ¯Ù„ Ù…ÛŒÚº ØªØ¨Ø¯ÛŒÙ„ÛŒ - Ø®Ø±Ú†Û Ø¬Ù…Ø¹ Ú©Ø±Ù†Û’ Ù¾Ø± ÙÙˆØ±ÛŒ Ø§Ù¾ÚˆÛŒÙ¹
        document.getElementById('expenseModal').addEventListener('submit', function(e) {
            e.preventDefault();
            submitExpenses();
        });
        
        // Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ø¦ÛŒÚº
        function generateReport() {
            try {
                const shop = document.getElementById('reportShop').value;
                const fromDate = document.getElementById('reportFromDate').value;
                const toDate = document.getElementById('reportToDate').value;
                const reportType = document.getElementById('reportType').value;
                
                // ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº
                let allReportData = [];
                
                // Ø³ÛŒÙ„Ø² ÚˆÛŒÙ¹Ø§
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('iceCreamData_')) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            allReportData.push(data);
                        } catch (error) {
                            console.error('Error loading sales data:', key, error);
                        }
                    } else if (key.startsWith('expenseData_')) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            allReportData.push(data);
                        } catch (error) {
                            console.error('Error loading expense data:', key, error);
                        }
                    }
                }
                
                // ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± ÚˆÛŒÙ¹Ø§
                handedOverData.forEach(item => {
                    item.type = 'handedOver';
                    allReportData.push(item);
                });
                
                // ÙÙ„Ù¹Ø± ÚˆÛŒÙ¹Ø§
                let filteredData = allReportData;
                
                if (shop !== 'all') {
                    filteredData = filteredData.filter(data => data.shop === shop);
                }
                
                if (fromDate) {
                    filteredData = filteredData.filter(data => new Date(data.date) >= new Date(fromDate));
                }
                
                if (toDate) {
                    filteredData = filteredData.filter(data => new Date(data.date) <= new Date(toDate));
                }
                
                // Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ø¦ÛŒÚº
                let reportHTML = `
                    <h3 style="text-align: center; margin: 15px 0; color: #2d3436;">
                        ${reportType === 'daily' ? 'Ø±ÙˆØ²Ø§Ù†Û' : reportType === 'weekly' ? 'ÛÙØªÛ ÙˆØ§Ø±' : reportType === 'monthly' ? 'Ù…Ø§ÛØ§Ù†Û' : 'Ø³Ø§Ù„Ø§Ù†Û'} Ø±Ù¾ÙˆØ±Ù¹
                    </h3>
                    <p style="text-align: center; margin-bottom: 15px; color: #636e72;">
                        ${shop === 'all' ? 'ØªÙ…Ø§Ù… Ø´Ø§Ù¾Ø³' : shopsData[shop].name}
                    </p>
                `;
                
                if (filteredData.length === 0) {
                    reportHTML += `<p style="text-align: center; color: #636e72; font-size: 1rem; padding: 20px;">Ú©ÙˆØ¦ÛŒ ÚˆÛŒÙ¹Ø§ Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚº ÛÛ’</p>`;
                } else {
                    // Ù…Ø¬Ù…ÙˆØ¹ÛŒ Ø­Ø³Ø§Ø¨ Ú©ØªØ§Ø¨
                    let totalShopRent = 0;
                    let totalElectricity = 0;
                    let totalSalary = 0;
                    let totalIceCreamPurchase = 0;
                    let totalIceCreamPaid = 0;
                    let totalOtherExpenses = 0;
                    let totalHandedOver = 0;
                    let totalCashInHand = 0;
                    let totalSales = 0;
                    
                    filteredData.forEach(data => {
                        if (data.type === 'sale') {
                            totalSales += data.totalSale || 0;
                            totalCashInHand += data.cashInHand || 0;
                        } else if (data.type === 'expense' && data.expenses) {
                            totalShopRent += data.expenses.shopRent || 0;
                            totalElectricity += data.expenses.electricityBill || 0;
                            totalSalary += data.expenses.salary || 0;
                            totalIceCreamPurchase += data.expenses.iceCreamPurchase || 0;
                            totalIceCreamPaid += data.expenses.iceCreamPaid || 0;
                            
                            if (data.expenses.otherExpenses) {
                                data.expenses.otherExpenses.forEach(expense => {
                                    totalOtherExpenses += expense.amount || 0;
                                });
                            }
                        } else if (data.type === 'handedOver') {
                            totalHandedOver += data.amount || 0;
                        }
                    });
                    
                    const totalExpenses = totalShopRent + totalElectricity + totalSalary + totalIceCreamPaid + totalOtherExpenses;
                    const netCashInHand = totalCashInHand - totalHandedOver;
                    const profitLoss = totalSales - totalExpenses;
                    const iceCreamPending = totalIceCreamPurchase - totalIceCreamPaid;
                    
                    reportHTML += `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="text-align: center; margin-bottom: 12px; color: #2d3436;">Ù…Ø¬Ù…ÙˆØ¹ÛŒ Ø±Ù¾ÙˆØ±Ù¹</h3>
                            <div style="overflow-x: auto;">
                                <table class="report-table">
                                    <tr>
                                        <th>Ú©Ù„ Ø³ÛŒÙ„</th>
                                        <td>${totalSales} Ú¯Ø±Ø§Ù…</td>
                                    </tr>
                                    <tr>
                                        <th>Ú©Ù„ Ø§Ø®Ø±Ø§Ø¬Ø§Øª</th>
                                        <td>${totalExpenses} Ø±ÙˆÙ¾Û’</td>
                                    </tr>
                                    <tr>
                                        <th>Ø´Ø§Ù¾ Ú©Ø±Ø§ÛŒÛ</th>
                                        <td>${totalShopRent} Ø±ÙˆÙ¾Û’</td>
                                    </tr>
                                    <tr>
                                        <th>Ø¨Ø¬Ù„ÛŒ Ú©Ø§ Ø¨Ù„</th>
                                        <td>${totalElectricity} Ø±ÙˆÙ¾Û’</td>
                                    </tr>
                                    <tr>
                                        <th>Ù…Ù„Ø§Ø²Ù… Ú©ÛŒ ØªÙ†Ø®ÙˆØ§Û</th>
                                        <td>${totalSalary} Ø±ÙˆÙ¾Û’</td>
                                    </tr>
                                    <tr>
                                        <th>Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… (Ú©Ù„)</th>
                                        <td>${totalIceCreamPurchase} Ø±ÙˆÙ¾Û’</td>
                                    </tr>
                                    <tr>
                                        <th>Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</th>
                                        <td>${totalIceCreamPaid} Ø±ÙˆÙ¾Û’</td>
                                    </tr>
                                    <tr>
                                        <th>Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ù¾ÛŒÙ†ÚˆÙ†Ú¯</th>
                                        <td class="${iceCreamPending > 0 ? 'profit-negative' : 'profit-positive'}">${iceCreamPending} Ø±ÙˆÙ¾Û’</td>
                                    </tr>
                                    <tr>
                                        <th>Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª</th>
                                        <td>${totalOtherExpenses} Ø±ÙˆÙ¾Û’</td>
                                    </tr>
                                    <tr>
                                        <th>ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ú©ÛŒØ´</th>
                                        <td>${totalHandedOver} Ø±ÙˆÙ¾Û’</td>
                                    </tr>
                                    <tr>
                                        <th>Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ</th>
                                        <td>${netCashInHand} Ø±ÙˆÙ¾Û’</td>
                                    </tr>
                                    <tr>
                                        <th>Ù…Ù†Ø§ÙØ¹/Ù†Ù‚ØµØ§Ù†</th>
                                        <td class="${profitLoss >= 0 ? 'profit-positive' : 'profit-negative'}">
                                            ${profitLoss} Ø±ÙˆÙ¾Û’
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    `;
                    
                    // ØªÙØµÛŒÙ„ÛŒ Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø±Ù¾ÙˆØ±Ù¹
                    reportHTML += generateDetailedExpenseReport();
                }
                
                document.getElementById('reportContent').innerHTML = reportHTML;
            } catch (error) {
                showError('Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
            }
        }
        
        // ØªÙØµÛŒÙ„ÛŒ Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø±Ù¾ÙˆØ±Ù¹
        function generateDetailedExpenseReport() {
            let reportHTML = '<h3 style="text-align: center; margin: 15px 0; color: #2d3436;">ØªÙØµÛŒÙ„ÛŒ Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø±Ù¾ÙˆØ±Ù¹</h3>';
            
            const expenseEntries = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('expenseData_')) {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        expenseEntries.push(data);
                    } catch (error) {
                        console.error('Error loading expense data:', key, error);
                    }
                }
            }
            
            expenseEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (expenseEntries.length === 0) {
                reportHTML += '<p style="text-align: center; color: #636e72;">Ú©ÙˆØ¦ÛŒ Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ú©ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ù†ÛÛŒÚº ÛÛ’</p>';
            } else {
                expenseEntries.forEach(entry => {
                    const date = new Date(entry.date).toLocaleDateString('ur-PK');
                    reportHTML += `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #2d3436; margin-bottom: 10px;">${date} - ${entry.shopName}</h4>
                            <table class="report-table" style="width: 100%;">
                                <tr>
                                    <th>Ø®Ø±Ú†Û’ Ú©Ø§ Ù†Ø§Ù…</th>
                                    <th>Ø±Ù‚Ù…</th>
                                </tr>
                                <tr>
                                    <td>Ø´Ø§Ù¾ Ú©Ø±Ø§ÛŒÛ</td>
                                    <td>${entry.expenses.shopRent || 0} Ø±ÙˆÙ¾Û’</td>
                                </tr>
                                <tr>
                                    <td>Ø¨Ø¬Ù„ÛŒ Ú©Ø§ Ø¨Ù„</td>
                                    <td>${entry.expenses.electricityBill || 0} Ø±ÙˆÙ¾Û’</td>
                                </tr>
                                <tr>
                                    <td>Ù…Ù„Ø§Ø²Ù… Ú©ÛŒ ØªÙ†Ø®ÙˆØ§Û</td>
                                    <td>${entry.expenses.salary || 0} Ø±ÙˆÙ¾Û’</td>
                                </tr>
                                <tr>
                                    <td>Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ…</td>
                                    <td>${entry.expenses.iceCreamPurchase || 0} Ø±ÙˆÙ¾Û’</td>
                                </tr>
                                <tr>
                                    <td>Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</td>
                                    <td>${entry.expenses.iceCreamPaid || 0} Ø±ÙˆÙ¾Û’</td>
                                </tr>
                    `;
                    
                    // Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª
                    if (entry.expenses.otherExpenses && entry.expenses.otherExpenses.length > 0) {
                        entry.expenses.otherExpenses.forEach(expense => {
                            reportHTML += `
                                <tr>
                                    <td>${expense.name}</td>
                                    <td>${expense.amount} Ø±ÙˆÙ¾Û’</td>
                                </tr>
                            `;
                        });
                    }
                    
                    reportHTML += `
                            </table>
                        </div>
                    `;
                });
            }
            
            return reportHTML;
        }
        
        // PDF Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ ÙÙ†Ú©Ø´Ù† - Ø¨ÛØªØ± Ø´Ø¯Û
        function exportToPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Ø±Ø§Ø¦Ù¹ Ù¹Ùˆ Ù„ÛŒÙÙ¹ Ø³Ù¾ÙˆØ±Ù¹ Ú©Û’ Ù„ÛŒÛ’
                doc.setLanguage('ur');
                
                // Ø¹Ù†ÙˆØ§Ù†
                doc.setFontSize(20);
                doc.text('Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø³ÛŒÙ„Ø² Ø±Ù¾ÙˆØ±Ù¹', 105, 15, { align: 'center' });
                
                // ØªØ§Ø±ÛŒØ®
                const currentDate = new Date().toLocaleDateString('ur-PK');
                doc.setFontSize(12);
                doc.text(`ØªØ§Ø±ÛŒØ®: ${currentDate}`, 105, 25, { align: 'center' });
                
                let yPosition = 40;
                
                // ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº
                const allData = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('iceCreamData_') || key.startsWith('expenseData_')) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            allData.push(data);
                        } catch (error) {
                            console.error('Error loading data:', key, error);
                        }
                    }
                }
                
                // ÚˆÛŒÙ¹Ø§ Ú©Ùˆ ØªØ§Ø±ÛŒØ® Ú©Û’ Ø­Ø³Ø§Ø¨ Ø³Û’ ØªØ±ØªÛŒØ¨ Ø¯ÛŒÚº
                allData.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Ø³ÛŒÙ„Ø² ÚˆÛŒÙ¹Ø§
                doc.setFontSize(16);
                doc.text('Ø³ÛŒÙ„Ø² Ø§Ù†Ù¹Ø±ÛŒØ²', 105, yPosition, { align: 'center' });
                yPosition += 10;
                
                const salesData = allData.filter(data => data.type === 'sale');
                
                if (salesData.length === 0) {
                    doc.setFontSize(12);
                    doc.text('Ú©ÙˆØ¦ÛŒ Ø³ÛŒÙ„Ø² Ø§Ù†Ù¹Ø±ÛŒ Ù†ÛÛŒÚº ÛÛ’', 105, yPosition, { align: 'center' });
                    yPosition += 10;
                } else {
                    salesData.forEach((entry, index) => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        const date = new Date(entry.date).toLocaleDateString('ur-PK');
                        doc.setFontSize(10);
                        doc.text(`${date} - ${entry.shopName}`, 14, yPosition);
                        doc.text(`Ú©Ù„ Ø³ÛŒÙ„: ${entry.totalSale} Ú¯Ø±Ø§Ù…`, 14, yPosition + 5);
                        doc.text(`Ú©Ù„ Ú©ÛŒØ´: ${entry.totalCash} Ø±ÙˆÙ¾Û’`, 14, yPosition + 10);
                        doc.text(`Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ: ${entry.cashInHand || 0} Ø±ÙˆÙ¾Û’`, 14, yPosition + 15);
                        yPosition += 25;
                    });
                }
                
                // Ø§Ø®Ø±Ø§Ø¬Ø§Øª ÚˆÛŒÙ¹Ø§
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(16);
                doc.text('Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø§Ù†Ù¹Ø±ÛŒØ²', 105, yPosition, { align: 'center' });
                yPosition += 10;
                
                const expenseData = allData.filter(data => data.type === 'expense');
                
                if (expenseData.length === 0) {
                    doc.setFontSize(12);
                    doc.text('Ú©ÙˆØ¦ÛŒ Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø§Ù†Ù¹Ø±ÛŒ Ù†ÛÛŒÚº ÛÛ’', 105, yPosition, { align: 'center' });
                } else {
                    expenseData.forEach((entry, index) => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        const date = new Date(entry.date).toLocaleDateString('ur-PK');
                        doc.setFontSize(8);
                        doc.text(`${date} - ${entry.shopName}`, 14, yPosition);
                        doc.text(`Ø´Ø§Ù¾ Ú©Ø±Ø§ÛŒÛ: ${entry.expenses.shopRent || 0}`, 14, yPosition + 4);
                        doc.text(`Ø¨Ø¬Ù„ÛŒ: ${entry.expenses.electricityBill || 0}`, 14, yPosition + 8);
                        doc.text(`ØªÙ†Ø®ÙˆØ§Û: ${entry.expenses.salary || 0}`, 14, yPosition + 12);
                        doc.text(`Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ…: ${entry.expenses.iceCreamPurchase || 0}`, 14, yPosition + 16);
                        doc.text(`Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ: ${entry.expenses.iceCreamPaid || 0}`, 14, yPosition + 20);
                        
                        // Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª
                        if (entry.expenses.otherExpenses && entry.expenses.otherExpenses.length > 0) {
                            entry.expenses.otherExpenses.forEach((expense, expIndex) => {
                                doc.text(`${expense.name}: ${expense.amount}`, 14, yPosition + 24 + (expIndex * 4));
                            });
                            yPosition += 24 + (entry.expenses.otherExpenses.length * 4);
                        } else {
                            yPosition += 24;
                        }
                        
                        yPosition += 10;
                    });
                }
                
                // PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ
                doc.save('icecream-sales-report.pdf');
                showSuccess('PDF Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ ÛÙˆ Ú¯Ø¦ÛŒ!');
            } catch (error) {
                showError('PDF Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
            }
        }
        
        // Ø§ÛŒÚ©Ø³Ù„ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ ÙÙ†Ú©Ø´Ù†
        function exportToExcel() {
            try {
                // ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº
                const allData = [];
                
                // Ø³ÛŒÙ„Ø² ÚˆÛŒÙ¹Ø§
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('iceCreamData_')) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            allData.push({
                                Ù‚Ø³Ù…: 'Ø³ÛŒÙ„Ø²',
                                ØªØ§Ø±ÛŒØ®: new Date(data.date).toLocaleDateString('ur-PK'),
                                Ø´Ø§Ù¾: data.shopName,
                                'Ú©Ù„ Ø³ÛŒÙ„': data.totalSale,
                                'Ú©Ù„ Ú©ÛŒØ´': data.totalCash,
                                'Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ': data.cashInHand || 0
                            });
                        } catch (error) {
                            console.error('Error loading sales data:', key, error);
                        }
                    } else if (key.startsWith('expenseData_')) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            const expenseRow = {
                                Ù‚Ø³Ù…: 'Ø§Ø®Ø±Ø§Ø¬Ø§Øª',
                                ØªØ§Ø±ÛŒØ®: new Date(data.date).toLocaleDateString('ur-PK'),
                                Ø´Ø§Ù¾: data.shopName,
                                'Ø´Ø§Ù¾ Ú©Ø±Ø§ÛŒÛ': data.expenses.shopRent || 0,
                                'Ø¨Ø¬Ù„ÛŒ Ú©Ø§ Ø¨Ù„': data.expenses.electricityBill || 0,
                                'Ù…Ù„Ø§Ø²Ù… Ú©ÛŒ ØªÙ†Ø®ÙˆØ§Û': data.expenses.salary || 0,
                                'Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ…': data.expenses.iceCreamPurchase || 0,
                                'Ø®Ø±ÛŒØ¯ÛŒ Ú¯Ø¦ÛŒ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ': data.expenses.iceCreamPaid || 0
                            };
                            
                            // Ø¯ÛŒÚ¯Ø± Ø§Ø®Ø±Ø§Ø¬Ø§Øª
                            if (data.expenses.otherExpenses && data.expenses.otherExpenses.length > 0) {
                                data.expenses.otherExpenses.forEach((expense, index) => {
                                    expenseRow[`Ø®Ø±Ú†Û ${index + 1}`] = `${expense.name}: ${expense.amount}`;
                                });
                            }
                            
                            allData.push(expenseRow);
                        } catch (error) {
                            console.error('Error loading expense data:', key, error);
                        }
                    }
                }
                
                if (allData.length === 0) {
                    showError('Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ú©Û’ Ù„ÛŒÛ’ Ú©ÙˆØ¦ÛŒ ÚˆÛŒÙ¹Ø§ Ù†ÛÛŒÚº ÛÛ’');
                    return;
                }
                
                // Ø§ÛŒÚ©Ø³Ù„ Ø´ÛŒÙ¹ Ø¨Ù†Ø§Ø¦ÛŒÚº
                const ws = XLSX.utils.json_to_sheet(allData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ø³ÛŒÙ„Ø² Ø±Ù¾ÙˆØ±Ù¹');
                
                // Ø§ÛŒÚ©Ø³Ù„ ÙØ§Ø¦Ù„ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº
                XLSX.writeFile(wb, 'icecream-sales-report.xlsx');
                showSuccess('Ø§ÛŒÚ©Ø³Ù„ Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ ÛÙˆ Ú¯Ø¦ÛŒ!');
            } catch (error) {
                showError('Ø§ÛŒÚ©Ø³Ù„ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§: ' + error.message);
            }
        }
        
        // Ù¾Ø±Ù†Ù¹ Ø±Ù¾ÙˆØ±Ù¹
        function printReport() {
            const reportContent = document.getElementById('reportContent').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø³ÛŒÙ„Ø² Ø±Ù¾ÙˆØ±Ù¹</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; }
                            table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
                            th { background-color: #f2f2f2; }
                            .profit-positive { color: green; font-weight: bold; }
                            .profit-negative { color: red; font-weight: bold; }
                        </style>
                    </head>
                    <body>
                        <h1 style="text-align: center;">Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø³ÛŒÙ„Ø² Ø±Ù¾ÙˆØ±Ù¹</h1>
                        ${reportContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Ø¢Ù¹Ùˆ Ø³ÛŒÙˆ ÙÛŒÚ†Ø± Ú©Ùˆ Ø®ØªÙ… Ú©ÛŒØ§ Ú¯ÛŒØ§ - Ø§Ø¨ ØµØ±Ù Ù…ÛŒÙ†ÙˆÙ„ Ø³ÛŒÙˆ ÛÙˆÚ¯Ø§
        
        // Ø§Ù† Ù¾Ù¹ ÙÛŒÙ„ÚˆØ² Ù…ÛŒÚº Ø§Ù†Ù¹Ø± Ú©ÛŒ Ù¾Ø±ÛŒØ³ ÛÙˆÙ†Û’ Ù¾Ø± Ù„Ø§Ú¯ Ø§Ù†
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
        
        // ÙˆØ²Ù† Ø§ÛŒÚˆÙ¹ Ù¾Ø§Ø³ ÙˆØ±Úˆ ÙÛŒÙ„Úˆ Ù…ÛŒÚº Ø§Ù†Ù¹Ø± Ú©ÛŒ Ù¾Ø±ÛŒØ³ ÛÙˆÙ†Û’ Ù¾Ø± ØªØµØ¯ÛŒÙ‚
        document.getElementById('editWeightPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                confirmEditWeight();
            }
        });
        
        // ØªÙ…Ø§Ù… ÚˆÛŒÙ„ÛŒÙ¹ Ù¾Ø§Ø³ ÙˆØ±Úˆ ÙÛŒÙ„Úˆ Ù…ÛŒÚº Ø§Ù†Ù¹Ø± Ú©ÛŒ Ù¾Ø±ÛŒØ³ ÛÙˆÙ†Û’ Ù¾Ø± ØªØµØ¯ÛŒÙ‚
        document.getElementById('deleteAllPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                confirmDeleteAll();
            }
        });

        // Ø§Ø¨ØªØ¯Ø§Ø¦ÛŒ Ù„ÙˆÚˆÙ†Ú¯
        window.addEventListener('load', function() {
            updateCurrentDate();
        });
    </script>
</body>
</html>
