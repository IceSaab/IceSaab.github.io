<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø³ÛŒÙ„Ø² Ù…ÛŒÙ†ÛŒØ¬Ø± - Online Ready</title>
<style>
/* (Compact styles - responsive & modern) */
:root{--bg1:#667eea;--bg2:#764ba2;--accent:#0984e3;--green:#00b894;--danger:#d63031}
*{box-sizing:border-box;font-family:Segoe UI, Tahoma, Verdana, sans-serif}
body{margin:0;min-height:100vh;background:linear-gradient(135deg,var(--bg1),var(--bg2));padding:18px}
.container{max-width:1200px;margin:0 auto;background:#fff;border-radius:14px;overflow:hidden;box-shadow:0 20px 40px rgba(0,0,0,0.15)}
.header{padding:20px;text-align:center;background:linear-gradient(90deg,#ff6b6b,#ee5a24);color:#fff}
.header h1{margin:0;font-size:1.6rem}
.topbar{display:flex;gap:10px;justify-content:center;padding:12px;background:#f7f9fb}
.btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
.btn-primary{background:var(--accent);color:#fff}
.btn-ghost{background:transparent;border:2px solid #eee}
.summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;padding:16px}
.card{background:linear-gradient(90deg,#fff,#f8f9fa);padding:12px;border-radius:10px;text-align:center}
.table-wrap{overflow:auto;padding:16px;background:#fff}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:center}
.input{padding:8px;width:100%;border-radius:6px;border:1px solid #ddd;text-align:center}
.footer{padding:18px;text-align:center;background:#f1f4f8}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:999}
.modal .box{background:#fff;padding:18px;border-radius:10px;max-width:720px;width:95%}
.flex{display:flex;gap:8px;align-items:center}
.rtl{text-align:right}
.small{font-size:0.9rem;color:#555}
.badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#f1f2f6}
@media(max-width:720px){.summary{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="container" id="app" style="display:none">
  <div class="header">
    <h1>ğŸ¦ Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø³ÛŒÙ„Ø² Ù…ÛŒÙ†ÛŒØ¬Ø± (Online Ready)</h1>
    <div class="small">LocalStorage-based; GitHub Pages / Netlify Ù¾Ø± Ø³ÛŒØ¯Ú¾Ø§ Ú†Ù„ Ø¬Ø§Ø¦Û’ Ú¯Ø§</div>
  </div>

  <div class="topbar">
    <button class="btn btn-primary" onclick="openExpenses()">ğŸ“Š Ø§Ø®Ø±Ø§Ø¬Ø§Øª</button>
    <button class="btn btn-primary" onclick="openHandedOver()">ğŸ¤ ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ±</button>
    <button class="btn btn-ghost" onclick="exportPDF()">ğŸ“„ Ù¾Ø±Ù†Ù¹ / PDF</button>
    <select id="shopSelect" class="input" style="max-width:220px" onchange="switchShop(this.value)">
      <option value="delhi">Ø¯ÛÙ„ÛŒ Ú¯ÛŒÙ¹</option>
      <option value="shahalam">Ø´Ø§Û Ø¹Ø§Ù„Ù…</option>
      <option value="lohari">Ù„ÙˆÛØ§Ø±ÛŒ Ú¯ÛŒÙ¹</option>
      <option value="bilal">Ø¨Ù„Ø§Ù„ Ú¯Ù†Ø¬</option>
    </select>
  </div>

  <div class="summary">
    <div class="card">
      <div class="small">Ú©Ù„ ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ú©ÛŒØ´</div>
      <div id="totalHanded" style="font-weight:800">0 Ø±ÙˆÙ¾Û’</div>
    </div>
    <div class="card">
      <div class="small">Ù…ÙˆØ¬ÙˆØ¯Û Ú©ÛŒØ´ Ø§Ù† ÛÛŒÙ†Úˆ</div>
      <div id="cashInHand" style="font-weight:800">0 Ø±ÙˆÙ¾Û’</div>
    </div>
    <div class="card">
      <div class="small">Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ù¾ÛŒÙ†ÚˆÙ†Ú¯</div>
      <div id="pendingPurchase" style="font-weight:800">0 Ø±ÙˆÙ¾Û’</div>
    </div>
  </div>

  <div class="table-wrap">
    <table id="productsTable">
      <thead>
        <tr><th>Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ…</th><th>Ù¾Ø±Ø§Ù†Ø§ ÙˆØ²Ù† (Ú¯Ø±Ø§Ù…)</th><th>Ù†ÛŒØ§ ÙˆØ²Ù† (Ú¯Ø±Ø§Ù…)</th><th>Ø³ÛŒÙ„ ÛÙˆØ¦ÛŒ (Ú¯Ø±Ø§Ù…)</th><th>Ù…ÙˆØ¬ÙˆØ¯Û ÙˆØ²Ù†</th></tr>
      </thead>
      <tbody id="productsBody"></tbody>
    </table>
  </div>

  <div class="table-wrap" style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
    <div style="flex:1;min-width:220px">
      <label class="small">Ù¹ÙˆÙ¹Ù„ Ú©ÛŒØ´ (Ø±ÙˆÙ¾Û’)</label>
      <input id="totalCash" class="input" type="number" oninput="updateComparison()" />
    </div>
    <div>
      <button class="btn btn-primary" onclick="autoCalc()">ğŸ”¢ Auto</button>
    </div>
    <div style="flex:1;min-width:220px">
      <div id="comparison" class="badge">Ú©ÛŒØ´ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº</div>
    </div>
    <div>
      <button class="btn btn-primary" id="saveBtn" onclick="saveData()" disabled>ğŸ’¾ Save</button>
    </div>
  </div>

  <div style="padding:12px">
    <div class="small">Ù†ÙˆÙ¹Ø³: ÛŒÛ ÙØ§Ø¦Ù„ Ø¨Ø±Ø§ÛÙ Ø±Ø§Ø³Øª GitHub Pages / Netlify Ù¾Ø± ÛÙˆØ³Ù¹ Ú©ÛŒ Ø¬Ø§ Ø³Ú©ØªÛŒ ÛÛ’Û” ÛØ± ÛŒÙˆØ²Ø± Ú©Ø§ ÚˆÛŒÙ¹Ø§ Ø§Ù† Ú©Û’ Ø¨Ø±Ø§Ø¤Ø²Ø± Ù…ÛŒÚº Ù…Ø­ÙÙˆØ¸ ÛÙˆÚ¯Ø§ (localStorage)</div>
  </div>

  <div class="footer small">Developed for quick online deploy â€” Hassan</div>
</div>

<!-- Login Modal -->
<div class="modal" id="loginModal" style="display:flex">
  <div class="box rtl">
    <h3>ğŸ¦ Ù„Ø§Ú¯ Ø§Ù† Ú©Ø±ÛŒÚº</h3>
    <div class="flex">
      <input id="loginId" class="input" placeholder="ID Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº" />
      <input id="loginPass" class="input" placeholder="Password" type="password"/>
      <button class="btn btn-primary" onclick="doLogin()">Ù„Ø§Ú¯ Ø§Ù†</button>
    </div>
    <div class="small">Demo credentials: ID = <b>03237131918</b> | Password = <b>Saab</b></div>
  </div>
</div>

<!-- Expenses Modal -->
<div class="modal" id="expenseModal">
  <div class="box rtl">
    <h3>Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
      <input id="rent" class="input" placeholder="Ø´Ø§Ù¾ Ú©Ø±Ø§ÛŒÛ (Ø±ÙˆÙ¾Û’)"/>
      <input id="electric" class="input" placeholder="Ø¨Ø¬Ù„ÛŒ Ú©Ø§ Ø¨Ù„"/>
      <input id="salary" class="input" placeholder="Ù…Ù„Ø§Ø²Ù…ÛŒÙ† Ú©ÛŒ ØªÙ†Ø®ÙˆØ§Û"/>
      <input id="purchase" class="input" placeholder="Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ù„ Ø±Ù‚Ù…"/>
      <input id="paid" class="input" placeholder="Ø¢Ø¦Ø³ Ú©Ø±ÛŒÙ… Ù¾ÛŒÚˆ Ø±Ù‚Ù…"/>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn btn-primary" onclick="submitExpenses()">Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº</button>
      <button class="btn" onclick="closeExpenses()">Ù…Ù†Ø³ÙˆØ®</button>
    </div>
  </div>
</div>

<!-- HandedOver Modal -->
<div class="modal" id="handedModal">
  <div class="box rtl">
    <h3>ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº</h3>
    <div style="display:flex;gap:8px">
      <input id="handedDate" type="date" class="input"/>
      <input id="handedAmount" type="number" class="input" placeholder="Ø±Ù‚Ù… (Ø±ÙˆÙ¾Û’)"/>
      <input id="handedNote" class="input" placeholder="ØªÙØµÛŒÙ„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"/>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn btn-primary" onclick="submitHanded()">Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº</button>
      <button class="btn" onclick="closeHanded()">Ù…Ù†Ø³ÙˆØ®</button>
    </div>
  </div>
</div>

<script>
// --- Core data structures ---
const shops = {
  delhi:{name:"Ø¯ÛÙ„ÛŒ Ú¯ÛŒÙ¹", products:["Ù¾Ø³ØªÛ Ø¨Ø§Ø¯Ø§Ù…","Ø³Ù¹Ø±Ø§Ø¨Ø±ÛŒ","Ú†Ø§Ú©Ù„ÛŒÙ¹","Ù¹ÙˆÙ¹ÛŒ ÙØ±ÙˆÙ¹ÛŒ","Ù…ÛŒÙ†Ú¯Ùˆ","Ø¨Ù„ÛŒÙˆØ¨ÛŒØ±ÛŒ","Ù¾Ø§Ø¦Ù† Ø§ÛŒÙ¾Ù„","ÙˆÙ†ÛŒÙ„Ø§","Ø§ÙˆØ±ÛŒÙˆ","Ù‚Ù„ÙÛ"]},
  shahalam:{name:"Ø´Ø§Û Ø¹Ø§Ù„Ù…", products:[]},
  lohari:{name:"Ù„ÙˆÛØ§Ø±ÛŒ Ú¯ÛŒÙ¹", products:[]},
  bilal:{name:"Ø¨Ù„Ø§Ù„ Ú¯Ù†Ø¬", products:[]}
};
// copy product lists into other shops
Object.keys(shops).forEach(k=>{ if(shops[k].products.length===0) shops[k].products=shops.delhi.products.slice() });

let currentShop = 'delhi';
let salesData = {}; // salesData[shop] = [{oldWeight, newWeight, sold, calcCurrent},...]
let expenses = {}; // expenses[shop] = {...}
let handed = []; // array of handed records

// --- Utilities ---
function uid(){ return 'ice_'+Date.now()+'_'+Math.floor(Math.random()*9999) }
function saveToLocal(){ localStorage.setItem('ice_app_saved', JSON.stringify({salesData,expenses,handed})) }
function loadFromLocal(){ const d = localStorage.getItem('ice_app_saved'); if(d){ const parsed=JSON.parse(d); salesData=parsed.salesData||{}; expenses=parsed.expenses||{}; handed=parsed.handed||[] } }

// --- Login ---
function doLogin(){
  const id=document.getElementById('loginId').value.trim();
  const p=document.getElementById('loginPass').value;
  if(id==='03237131918' && p==='Saab'){ document.getElementById('loginModal').style.display='none'; document.getElementById('app').style.display='block'; init(); }
  else alert('ØºÙ„Ø· Ø¢Ø¦ÛŒ ÚˆÛŒ ÛŒØ§ Ù¾Ø§Ø³ ÙˆØ±Úˆ');
}

// --- Initialize UI & data ---
function init(){
  loadFromLocal();
  renderProducts();
  updateSummary();
  document.getElementById('saveBtn').disabled=false;
}

// switch shop
function switchShop(val){
  currentShop=val;
  renderProducts();
  updateSummary();
}

function renderProducts(){
  const tbody=document.getElementById('productsBody'); tbody.innerHTML='';
  if(!salesData[currentShop]) salesData[currentShop]=shops[currentShop].products.map(_=>({oldWeight:0,newWeight:0,sold:0,calcCurrent:0}));
  salesData[currentShop].forEach((p,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${shops[currentShop].products[i]}</td>
      <td><input class="input" value="${p.oldWeight}" data-i="${i}" onchange="onOldChange(this)" /></td>
      <td><input class="input" value="${p.newWeight}" data-i="${i}" onchange="onNewChange(this)" /></td>
      <td><input class="input" value="${p.sold}" data-i="${i}" onchange="onSoldChange(this)"/></td>
      <td id="cur_${i}">${p.calcCurrent||0}</td>`;
    tbody.appendChild(tr);
  });
  updateComparison();
}

// input handlers
function onOldChange(el){ const i=+el.dataset.i; salesData[currentShop][i].oldWeight=+el.value||0; recalc(i); saveToLocal(); updateSummary(); }
function onNewChange(el){ const i=+el.dataset.i; salesData[currentShop][i].newWeight=+el.value||0; recalc(i); saveToLocal(); updateSummary(); }
function onSoldChange(el){ const i=+el.dataset.i; salesData[currentShop][i].sold=+el.value||0; recalc(i); saveToLocal(); updateSummary(); }

function recalc(i){
  const item = salesData[currentShop][i];
  item.calcCurrent = (item.oldWeight||0) + (item.newWeight||0) - (item.sold||0);
  document.getElementById('cur_'+i).textContent = item.calcCurrent;
}

// auto-calc cash from sold grams (1g = 1 unit)
function autoCalc(){
  const total = salesData[currentShop].reduce((s,p)=>s + (p.sold||0),0);
  document.getElementById('totalCash').value = total;
  updateComparison();
}

// comparison
function updateComparison(){
  const totalCash = +document.getElementById('totalCash').value || 0;
  const totalSale = salesData[currentShop] ? salesData[currentShop].reduce((s,p)=>s + (p.sold||0),0) : 0;
  const diff = totalCash - totalSale;
  const cmp = document.getElementById('comparison');
  if(totalCash===0) cmp.textContent='Ú©ÛŒØ´ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº';
  else if(diff===0) cmp.textContent='âœ… Ú©ÛŒØ´ Ø¨Ø§Ù„Ú©Ù„ ØµØ­ÛŒØ­ ÛÛ’';
  else if(diff>0) cmp.textContent='â• '+diff+' Ø±ÙˆÙ¾Û’ Ø²ÛŒØ§Ø¯Û';
  else cmp.textContent='â– '+Math.abs(diff)+' Ø±ÙˆÙ¾Û’ Ú©Ù…';
}

// save
function saveData(){
  const record = {
    type:'sale',
    shop: currentShop,
    shopName: shops[currentShop].name,
    date: new Date().toISOString(),
    salesData: JSON.parse(JSON.stringify(salesData[currentShop])),
    totalSale: salesData[currentShop].reduce((s,p)=>s + (p.sold||0),0),
    timestamp: Date.now(),
    key: uid()
  };
  // push into local storage array
  let arr = JSON.parse(localStorage.getItem('ice_records')||'[]');
  arr.push(record);
  localStorage.setItem('ice_records', JSON.stringify(arr));
  saveToLocal();
  alert('ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ ÛÙˆÚ¯ÛŒØ§!');
  updateSummary();
}

// expenses modal
function openExpenses(){ document.getElementById('expenseModal').style.display='flex' }
function closeExpenses(){ document.getElementById('expenseModal').style.display='none' }
function submitExpenses(){
  if(!expenses[currentShop]) expenses[currentShop]={rent:0,electric:0,salary:0,purchase:0,paid:0,others:[]};
  expenses[currentShop].rent = +document.getElementById('rent').value || 0;
  expenses[currentShop].electric = +document.getElementById('electric').value || 0;
  expenses[currentShop].salary = +document.getElementById('salary').value || 0;
  expenses[currentShop].purchase = +document.getElementById('purchase').value || 0;
  expenses[currentShop].paid = +document.getElementById('paid').value || 0;
  saveToLocal();
  closeExpenses();
  alert('Ø§Ø®Ø±Ø§Ø¬Ø§Øª Ù…Ø­ÙÙˆØ¸ ÛÙˆÚ¯Ø¦Û’');
  updateSummary();
}

// handed over
function openHandedOver(){ document.getElementById('handedModal').style.display='flex' }
function closeHanded(){ document.getElementById('handedModal').style.display='none' }
function submitHanded(){
  const d=document.getElementById('handedDate').value || new Date().toISOString().split('T')[0];
  const amt= +document.getElementById('handedAmount').value || 0;
  const note=document.getElementById('handedNote').value || '';
  if(amt<=0){ alert('ØµØ­ÛŒØ­ Ø±Ù‚Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº'); return; }
  handed.push({date:d,amount:amt,note,shop:currentShop,key:uid()});
  saveToLocal();
  closeHanded();
  alert('ÛÛŒÙ†ÚˆÚˆ Ø§ÙˆÙˆØ± Ù…Ø­ÙÙˆØ¸ ÛÙˆÚ¯ÛŒØ§');
  updateSummary();
}

// summary
function updateSummary(){
  // total handed for current shop
  const th = handed.filter(h=>h.shop===currentShop).reduce((s,h)=>s+h.amount,0);
  document.getElementById('totalHanded').textContent = th + ' Ø±ÙˆÙ¾Û’';
  // cash in hand - sum of last saved totalCash for this shop from records (approx)
  const recs = JSON.parse(localStorage.getItem('ice_records')||'[]').filter(r=>r.shop===currentShop);
  const lastTotal = recs.length ? recs[recs.length-1].totalSale : 0;
  document.getElementById('cashInHand').textContent = lastTotal + ' Ø±ÙˆÙ¾Û’';
  // pending purchase
  const shopExp = expenses[currentShop] || {purchase:0,paid:0};
  const pending = (shopExp.purchase || 0) - (shopExp.paid || 0);
  document.getElementById('pendingPurchase').textContent = pending + ' Ø±ÙˆÙ¾Û’';
}

// export / print
function exportPDF(){ window.print(); }

// load saved app state on startup
(function(){
  loadFromLocal();
  // show login modal by default (already visible)
})();
</script>
</body>
</html>
